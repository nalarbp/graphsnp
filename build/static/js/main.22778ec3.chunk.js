(this["webpackJsonpgraph-snp"]=this["webpackJsonpgraph-snp"]||[]).push([[0],{1047:function(e,t,a){},1350:function(e,t,a){},1353:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(0),s=a.n(r),i=a(33),c=a.n(i),o=(a(584),a(191)),l=a(192),d=a(193),u=a(202),p=(a(585),a(48)),h=a(1387),g=a(1386),j=a(1378),b=a(548),f=(a(358),a(37)),m=a(31),x="INPUT_LOADING",O="IS_SHOWING_LOADING_MODAL",y="GRAPH_OBJECT",v="GRAPH_CLUSTER",S="MATRIX_HAMMING",_="NAV_LOCATION",T="SEQ_DATA",w="META_DATA",E="METADATA_CATEGORICAL",D="TIME_TREE_DATA",C="COLOR_LUT",I="SELECT_DEMO_DATA",L="SELECTED_NODE",N="SETTING_METHOD",M="SETTING_LAYOUT",A="SETTING_IS_USER_REDRAW",U="SETTING_EDGE_FILTER_CUTOFF",k="SETTING_IS_USER_FILTER_EDGES",R="SETTING_CLUSTER_METHOD",F="SETTING_IS_USER_CLUSTERING",P="SETTING_IS_EDGE_SCALED",G="SETTING_EDGE_SCALE_FACTOR",q="SETTING_IS_HIDE_EDGES",z="SETTING_EDGE_HIDE_CUTOFF",H="SETTING_COLOR_NODE_BY",B="SETTING_EXPORT_FORMAT",V="SETTING_IS_USER_DOWNLOADING",Y="SETTING_TRANS_LOC_LEVEL",W="SETTING_TYPE_ANALYSIS",X="SETTING_CHART_SESSION",$="SETTING_IS_USER_LOAD_SESSION",J="SETTING_IS_USER_RELAYOUT",K="DIST_DATA_TO_DISPLAY",Q="DIST_DATA_COLUMN",Z="DIST_DATA_COLUMN_LEVEL",ee="DIST_CHART_ORIENTATION",te="DIST_CHART_TYPE",ae="DIST_IS_USER_GENERATE_MATRIX",ne="DIST_EXPORT_FORMAT",re="DIST_IS_USER_DRAW",se="DIST_IS_USER_EXPORT",ie="DIST_CHART_SESSION",ce="DIST_IS_USER_LOAD_SESSION",oe={demo1:{snps:"./data/demoFile/1/st78_snps_input.fa",metadata:"./data/demoFile/1/st78_metadata_input.csv",stayTimeline:null},demo2:{snps:"./data/demoFile/2/esbl_KM_snps_input.fa",metadata:"./data/demoFile/2/esbl_KM_metadata_input.csv",stayTimeline:null}},le="./data/templateFile/snps_input.fa",de="./data/templateFile/metadata_input.csv";function ue(e){return{type:_,payload:e}}var pe=a(1394),he=a(1374),ge=a(573),je=a(66),be=a(108),fe=a(1390),me=a(1391),xe=a(1392),Oe=a(1393);function ye(e){return{type:T,payload:e}}function ve(e){return{type:w,payload:e}}function Se(e){return{type:D,payload:e}}function _e(e){return{type:x,payload:e}}function Te(e){return{type:I,payload:e}}function we(e){return{type:S,payload:e}}function Ee(e){return{type:y,payload:e}}function De(e){return{type:v,payload:e}}var Ce=a(52),Ie=a.n(Ce),Le=a(175),Ne=a(1383),Me=a(1376),Ae=a(91),Ue=a.n(Ae),ke=a(95),Re=a(1382),Fe=a(532),Pe=a(1389),Ge=a(1366),qe=a(1365),ze=a(1388),He=Object(ke.extendMoment)(Ue.a),Be=a(21);function Ve(e,t,a){return a.indexOf(e)===t}function Ye(e,t){var a=Be.cloneDeep(e),n=null;if(Array.isArray(a)&&a.length>0){"clusterID"===t&&(a=a.filter((function(e){return"na"!==e.clusterID})));var r=[],s=[];a.forEach((function(e){r.push(e[t]),"sample_date"===t&&s.push(e.sample_date)}));var i=r.filter(Ve),c=s.length>0?qe.a(s):null,o=Object(Fe.a)(Ge.a).domain(i),l=c?function(e){var t=He(e[0]),a=He(e[1]),n=t.isoWeek().toString(),r=a.isoWeek().toString(),s=t.isoWeekYear().toString(),i=a.isoWeekYear().toString(),c=parseInt(s+n),o=parseInt(i+r);return Object(Re.a)(Pe.a).domain([c,o])}(c):null,d=new Map;a.forEach((function(e){if("sample_date"===t){var a=He(e[t]),n=a.isoWeek().toString(),r=a.isoWeekYear().toString(),s=parseInt(r+n),i=Object(ze.a)(l(s)).formatHex();d.set(e.sample,i)}else d.set(e.sample,o(e[t]))})),n=d}return n}function We(e,t){var a=Be.cloneDeep(t),n=new Map;return a.forEach((function(t){var a=t[e]&&Object(ze.a)(t[e])?Object(ze.a)(t[e]).formatHex():Object(ze.a)("lightgray").formatHex();n.set(t.sample_id,a)})),n}function Xe(e,t,a){var n="lightgray";if("na"!==t){var r=a[t];n=r.get(e)?r.get(e):"lightgray"}return n}function $e(e,t,a,n){if(e){var r=t+1,s=r?r*a:3;return"edge"===n||s<1?s:1}return"edge"===n?3:1}function Je(e){return e*Math.max(document.documentElement.clientHeight,window.innerHeight||0)/100}function Ke(e){var t=0;return e.hospital_id&&(t=1,e.ward_id&&(t=2,e.bay_id&&(t=3,e.bed_id&&(t=4)))),t}function Qe(e,t){var a=0;return e.hospital_id===t.hospital_id&&(a=1,e.ward_id===t.ward_id&&(a=2,e.bay_id===t.bay_id&&(a=3,e.bed_id===t.bed_id&&(a=4)))),a}function Ze(e,t){var a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}var et=a(590);function tt(e){this.seq=e,this.seqIDs=e.map((function(e){return e.id}))}tt.prototype.getHammingMatrix=function(){for(var e=this.seq,t=this.seqIDs,a=new Map,n=0;n<t.length-1;n++)for(var r=e[n],s=n+1;s<e.length;s++){var i=e[s],c=et(r.sequence,i.sequence);if(a.get(r.id)){var o=a.get(r.id);o.push({source:r.id,target:i.id,value:c,part:"upper"}),a.set(r.id,o)}else{var l=[{source:r.id,target:i.id,value:c,part:"upper"}];a.set(r.id,l)}if(a.get(i.id)){var d=a.get(i.id);d.push({source:i.id,target:r.id,value:c,part:"lower"}),a.set(i.id,d)}else{var u=[{source:i.id,target:r.id,value:c,part:"lower"}];a.set(i.id,u)}}return a};var at=tt,nt=a(21),rt=Object(ke.extendMoment)(Ue.a),st=a(591).fastaToJson,it=Object(Me.a)("%Y-%m-%d");function ct(e,t,a,n){return ot.apply(this,arguments)}function ot(){return(ot=Object(Le.a)(Ie.a.mark((function e(t,a,n,r){var s,i,c,o,l,d,u,p,h;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(t);case 2:if(s=e.sent,i=[],!(Array.isArray(s)&&s.length>1)){e.next=44;break}c={},o=[],l=!0,d=0;case 9:if(!(d<s.length)){e.next=41;break}if(u=s[d].messages,p=s[d].parsedSequence,h=s[d].success,-1===o.indexOf(p.size)&&o.push(p.size),h){e.next=19;break}return l=!1,alert("Parsing error:",p.name),r(!1),e.abrupt("break",41);case 19:if(!(u.length>0)){e.next=24;break}return l=!1,alert(u[0]),r(!1),e.abrupt("break",41);case 24:if(!(o.length>1)){e.next=29;break}return l=!1,alert("Size error: Alignment required sequences with same length"),r(!1),e.abrupt("break",41);case 29:if(c[p.name]){e.next=33;break}c[p.name]=!0,e.next=37;break;case 33:return l=!1,alert("Sequence error: Duplicated sequence"),r(!1),e.abrupt("break",41);case 37:l&&i.push({id:p.name,size:p.size,sequence:p.sequence.toLowerCase()});case 38:d++,e.next=9;break;case 41:l&&(ge.b.success("The sequences have been loaded, now building distance matrix ..",1),setTimeout((function(){var e=new at(i).getHammingMatrix();ge.b.success("Pair-wise SNP distance matrix has been created",1),a(i),n(e),r(!1)}),100)),e.next=46;break;case 44:alert("Error: Check the SNP alignment input requirements"),r(!1);case 46:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e,t,a,n,r){return dt.apply(this,arguments)}function dt(){return(dt=Object(Le.a)(Ie.a.mark((function e(t,a,n,r,s){var i,c,o,l,d,u,p,h,g,j,b,f,m;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ne.a)(t).then((function(e){return e}));case 2:if(i=e.sent,c=["sample_id","sample_date"],o=Object.keys(i[0]),l=!0,c.forEach((function(e){-1===o.indexOf(e)&&(l=!1)})),l){e.next=11;break}return alert("Invalid headers: One or more required headers was not found"),s(!1),e.abrupt("return");case 11:if(d=nt.countBy(i,"sample_id"),!((u=Object.keys(d).map((function(e){return{name:e,count:d[e]}})).filter((function(e){return e.count>1}))).length>0)){e.next=17;break}return alert("Invalid data: duplicate record in column sample id"+"".concat(JSON.stringify(u))),s(!1),e.abrupt("return");case 17:if(!!!d[""]){e.next=22;break}return alert("Invalid data: column sample_id contain empty record"),s(!1),e.abrupt("return");case 22:if(p=!1,i.forEach((function(e){e.sample_id=e.sample_id.replace(/\s*$/,""),e.sample_date=e.sample_date.replace(/\s*$/,""),it(e.sample_date)?(e.uid=e.sample_id,e.sample_date=it(e.sample_date)):p=!0})),!p){e.next=28;break}return alert("Invalid data: wrong date format in column sample date"),s(!1),e.abrupt("return");case 28:h=[],g=[],o.forEach((function(e){var t=e.split(":");t.length>1&&"color"===t[1]?g.push(t[0]):"sample_id"!==e&&h.push(e)})),j={},b=new Map,f=["0",0,"null","na","#N/A","NA","","excluded"],h.forEach((function(e){var t=e,a=[],n=[];i.forEach((function(e){var r={};r.sample=e.sample_id,r[t]=e[t],n.push(r),a.push(e[t])})),a.filter(Ve),a.forEach((function(e){var a=n.filter((function(a){return a[t]===e})).map((function(e){return e.sample}));if(-1===f.indexOf(e)){var r=t.concat("-",e);b.set(r,a)}}));var r=null;g.indexOf(e)>-1?r=We(e.concat(":color"),i):r=Ye(n,t);j[t]=r})),m=new Map,i.forEach((function(e){m.set(e.sample_id,e)})),a(m),n(j),r(b),s(!1);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(){return(ut=Object(Le.a)(Ie.a.mark((function e(t,a,n){var r,s,i,c,o,l,d;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ne.a)(t).then((function(e){return e}));case 2:if(r=e.sent,s=["patient_id","start_date","end_date","hospital_id","ward_id","bay_id","bed_id"],i=["null",""," ","na","NA","N/A","#N/A","NULL","Null"],c=Object.keys(r[0]),o=!0,s.forEach((function(e){-1===c.indexOf(e)&&(o=!1)})),o){e.next=12;break}return alert("Invalid headers: One or more required headers was not found"),n(!1),e.abrupt("return");case 12:if(l=!1,r.forEach((function(e){e.patient_id=e.patient_id.replace(/\s*$/,""),e.start_date=e.start_date.replace(/\s*$/,""),e.end_date=e.end_date.replace(/\s*$/,""),e.hospital_id=-1!==i.indexOf(e.hospital_id)?null:e.hospital_id.replace(/\s*$/,""),e.ward_id=-1!==i.indexOf(e.ward_id)?null:e.ward_id.replace(/\s*$/,""),e.bay_id=-1!==i.indexOf(e.bay_id)?null:e.bay_id.replace(/\s*$/,""),e.bed_id=-1!==i.indexOf(e.bed_id)?null:e.bed_id.replace(/\s*$/,""),rt(e.start_date)&&rt(e.end_date)?(e.start_date=rt(e.start_date),e.end_date=rt(e.end_date)):l=!0})),!l){e.next=18;break}return alert("Invalid data: wrong date format in column start_date and or end_date"),n(!1),e.abrupt("return");case 18:d=new Map,r.map((function(e){return e.patient_id})).filter(Ve).forEach((function(e){var t=[];r.filter((function(t){return t.patient_id===e})).forEach((function(a){var n={pid:e,start_date:a.start_date,end_date:a.end_date,hospital_id:a.hospital_id,ward_id:a.ward_id,bay_id:a.bay_id,bed_id:a.bed_id};t.push(n)})),d.set(e,t)})),a(d),n(!1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pt=he.a.Dragger;var ht=Object(f.b)((function(e){return{sequence:e.sequence,patientMovement:e.patientMovement}}),(function(e){return Object(m.b)({sequenceToStore:ye,isinputLoadingToStore:_e,hmmMatrixToStore:we},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{children:[Object(n.jsx)(pt,{accept:".fa, .fasta, .fna, .mfa",showUploadList:!1,style:{backgroundColor:"transparent",height:"500px"},name:"file",multiple:!1,action:"dummy-post",beforeUpload:function(t){if(t){var a=new FileReader;a.readAsText(t),e.isinputLoadingToStore(!0),a.onloadend=function(t){console.log(t),ct(t.target.result,e.sequenceToStore,e.hmmMatrixToStore,e.isinputLoadingToStore)}}return!1},children:Object(n.jsx)("div",{id:"input-loader-snps",children:Object(n.jsxs)(je.a,{id:"input-loader-button-snps",shape:"round",size:"large",children:[e.sequence?Object(n.jsx)(fe.a,{style:{fontSize:"14pt"}}):Object(n.jsx)(me.a,{})," SNPs ","  ",Object(n.jsx)("span",{style:{marginLeft:"5px"},children:Object(n.jsx)(be.a,{title:"Input or drag and drop non-ambiguous multi-fasta SNPs alignment file here",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{fontSize:"14px",color:"white"}})})})]})})}),Object(n.jsx)("div",{className:"remove-button-container",children:Object(n.jsx)(je.a,{disabled:!e.sequence,title:"Remove loaded SNPs alignment",type:"ghost",className:"input-loader-remove-button ",shape:"circle",size:"small",onClick:function(t){e.sequenceToStore(null),e.hmmMatrixToStore(null)},children:Object(n.jsx)(Oe.a,{})})})]})})}));function gt(e){return{type:C,payload:e}}function jt(e){return{type:E,payload:e}}var bt=he.a.Dragger;var ft=Object(f.b)((function(e){return{metadata:e.metadata}}),(function(e){return Object(m.b)({metadataToStore:ve,colorLUTtoStore:gt,isinputLoadingToStore:_e,categoricalMapToStore:jt},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{children:[Object(n.jsx)(bt,{accept:".csv",showUploadList:!1,style:{height:"500px",backgroundColor:"transparent"},name:"file",multiple:!1,action:"dummy-post",beforeUpload:function(t){if(t){var a=new FileReader;a.readAsDataURL(t),e.isinputLoadingToStore(!0),a.onloadend=function(t){lt(t.target.result,e.metadataToStore,e.colorLUTtoStore,e.categoricalMapToStore,e.isinputLoadingToStore)}}return!1},children:Object(n.jsx)("div",{id:"input-loader-metadata",children:Object(n.jsxs)(je.a,{id:"input-loader-button-metadata",shape:"round",size:"large",children:[e.metadata?Object(n.jsx)(fe.a,{style:{fontSize:"14pt"}}):Object(n.jsx)(me.a,{})," Metadata"," ",Object(n.jsx)("span",{style:{marginLeft:"5px"},children:Object(n.jsx)(be.a,{title:"Input or drag and drop metadata file (CSV) here",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{fontSize:"14px",color:"white"}})})})]})})}),Object(n.jsx)("div",{className:"remove-button-container",children:Object(n.jsx)(je.a,{disabled:!e.metadata,title:"Remove loaded metadata",type:"ghost",className:"input-loader-remove-button ",shape:"circle",size:"small",onClick:function(t){e.metadataToStore(null),e.colorLUTtoStore(null),e.categoricalMapToStore(null)},children:Object(n.jsx)(Oe.a,{})})})]})})})),mt=a(201),xt=mt.a.Option;var Ot=Object(f.b)((function(e){return{selectDemoData:e.selectDemoData}}),(function(e){return Object(m.b)({selectDemoDataToStore:Te,sequenceToStore:ye,metadataToStore:ve,patientMovementToStore:Se,isinputLoadingToStore:_e,hmmMatrixToStore:we,colorLUTtoStore:gt,categoricalMapToStore:jt},e)}))((function(e){var t=e.selectDemoData;function a(){return(a=Object(Le.a)(Ie.a.mark((function e(t,a,n,r,s){var i,c,o;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return i=e.sent,r(!0),e.next=6,i.blob();case 6:c=e.sent,(o=new FileReader).readAsText(c),o.onloadend=function(e){var t=e.target.result;s(t,a,n,r)};case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsx)(g.a,{xs:24,children:Object(n.jsxs)(mt.a,{value:t,onChange:function(t){if(t){var n=oe[t];e.sequenceToStore(null),e.hmmMatrixToStore(null),e.metadataToStore(null),e.colorLUTtoStore(null),e.categoricalMapToStore(null),e.patientMovementToStore(null),n.snps&&function(e,t,n,r,s){a.apply(this,arguments)}(n.snps,e.sequenceToStore,e.hmmMatrixToStore,e.isinputLoadingToStore,ct),n.metadata&&lt(n.metadata,e.metadataToStore,e.colorLUTtoStore,e.categoricalMapToStore,e.isinputLoadingToStore),n.stayTimeline&&function(e,t,a){ut.apply(this,arguments)}(n.stayTimeline,e.patientMovementToStore,e.isinputLoadingToStore),e.selectDemoDataToStore(t)}else e.selectDemoDataToStore(null)},children:[Object(n.jsx)(xt,{value:null,children:"Select demo data"}),Object(n.jsx)(xt,{value:"demo2",children:"ESBL K. michiganensis outbreak (Chapman et al., 2020)"}),Object(n.jsx)(xt,{value:"demo1",children:"VRE ST78 outbreak (Permana et al., 2021)"})]})})})})),yt=function(e){return Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{sm:24,id:"footer-component",children:Object(n.jsxs)("p",{children:[Object(n.jsx)("a",{href:"https://graphsnp.beatsonlab.com",target:"_blank",rel:"noopener noreferrer",children:Object(n.jsx)("b",{children:"GraphSNP v1.0"})}),Object(n.jsx)("br",{}),Object(n.jsxs)("b",{children:[" ","Graph-based, drag and drop web visualization tool for ",Object(n.jsx)("br",{}),"cluster and transmission analysis using pairwise SNP-distance."]}),Object(n.jsx)("br",{})," Developed by Budi Permana at"," ",Object(n.jsxs)("a",{href:"https://beatsonlab.com/",target:"_blank",rel:"noopener noreferrer",children:[" ","Beatson Lab"]}),Object(n.jsx)("br",{})," ",Object(n.jsx)("a",{href:"https://www.uq.edu.au/",target:"_blank",rel:"noopener noreferrer",children:"The University of Queensland"})," ","| Australia"]})})})},vt=a(546),St=a.n(vt),_t=Object(n.jsx)(pe.a,{style:{fontSize:34},spin:!0}),Tt=String(Je(100)-380)+"px",wt={fpsLimit:24,particles:{number:{value:25},size:{value:4},links:{enable:!0,distance:75},move:{enable:!0,speed:2,outModes:{default:"bounce"}}},interactivity:{events:{onhover:{enable:!1,mode:"repulse"}}}};var Et=Object(f.b)((function(e){return{isInputLoading:e.isInputLoading}}),(function(e){return Object(m.b)({changeNavLocation:ue},e)}))((function(e){return Object(n.jsxs)(s.a.Fragment,{children:[Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{xs:24,id:"header-content",children:Object(n.jsx)(j.a,{visible:e.isInputLoading,closable:!1,centered:!0,width:0,footer:null,bodyStyle:{textAlign:"center",padding:"0px"},children:Object(n.jsx)(b.a,{indicator:_t,style:{color:"white"},tip:"Processing...",size:"large"})})})}),Object(n.jsxs)(h.a,{id:"input-wrapper",children:[Object(n.jsx)(St.a,{params:wt,height:Tt,style:{position:"absolute",height:"200px"}}),Object(n.jsx)(g.a,{xs:24,sm:12,children:Object(n.jsx)(ht,{})}),Object(n.jsx)(g.a,{xs:24,sm:12,children:Object(n.jsx)(ft,{})})]}),Object(n.jsx)(h.a,{id:"demo-selection",children:Object(n.jsx)(Ot,{})}),Object(n.jsx)(yt,{})]})})),Dt=a(1368),Ct=a(110),It=(a(1047),a(58)),Lt=a(1380),Nt=a(1372),Mt=a(1395);function At(e){return{type:N,payload:e}}function Ut(e){return{type:M,payload:e}}function kt(e){return{type:A,payload:e}}function Rt(e){return{type:U,payload:e}}function Ft(e){return{type:k,payload:e}}function Pt(e){return{type:R,payload:e}}function Gt(e){return{type:F,payload:e}}function qt(e){return{type:P,payload:e}}function zt(e){return{type:G,payload:e}}function Ht(e){return{type:q,payload:e}}function Bt(e){return{type:z,payload:e}}function Vt(e){return{type:H,payload:e}}function Yt(e){return{type:B,payload:e}}function Wt(e){return{type:V,payload:e}}function Xt(e){return{type:Y,payload:e}}function $t(e){return{type:W,payload:e}}function Jt(e){return{type:X,payload:e}}function Kt(e){return{type:$,payload:e}}function Qt(e){return{type:L,payload:e}}function Zt(e){return{type:J,payload:e}}var ea=Lt.a.Panel,ta=Object(ke.extendMoment)(Ue.a);var aa=Object(f.b)((function(e){return{metadata:e.metadata,colorLUT:e.colorLUT,selectedNode:e.selectedNode,graphObject:e.graphObject}}),(function(e){return Object(m.b)({changeSelectedNode:Qt},e)}))((function(e){var t=Object(r.useState)({columns:null,cells:null}),a=Object(It.a)(t,2),i=a[0],c=a[1];return Object(r.useEffect)((function(){if(e.metadata&&e.selectedNode)if(e.selectedNode.length>0){var t=e.selectedNode.map((function(t){return e.metadata.get(t)})),a=[],n=[];t.forEach((function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var s=Object(It.a)(r[t],2),i=s[0],c=s[1];a.push({title:i,dataIndex:i,key:i+(0).toString()});var o=n[0],l={};o&&(l=Object.assign({},o)),l.key||(l.key=(0).toString()),l[i]="sample_date"===i?ta(c).format("YYYY-MM-DD"):c,n=[l]}})),c({columns:a,cells:n})}else c({columns:null,cells:null})}),[e.selectedNode]),Object(n.jsx)(s.a.Fragment,{children:Object(n.jsx)("div",{style:{position:"absolute",zIndex:"10",top:"inherit",width:"100%"},children:e.metadata&&e.graphObject&&Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(Lt.a,{bordered:!1,expandIconPosition:"left",children:Object(n.jsxs)(ea,{style:{marginBottom:"0px",textAlign:"left",overflowY:"auto"},header:Object(n.jsxs)("p",{style:{marginBottom:"0px"},children:[Object(n.jsx)(Mt.a,{})," Selected node metadata"]}),children:[e.selectedNode&&e.graphObject&&i.columns&&Object(n.jsx)(Nt.a,{size:"small",pagination:!1,style:{width:"100%"},dataSource:i.cells,columns:i.columns}),!e.selectedNode&&Object(n.jsx)("p",{children:"No selected node"})]},"100")})})})})})})),na=a(203),ra=a(1384),sa=a(1367),ia=a(1396),ca=a(349),oa=a(494).Graph,la=a(1160);function da(e){return{type:O,payload:e}}var ua=mt.a.Option,pa=Object(n.jsx)(pe.a,{style:{fontSize:34},spin:!0});var ha=Object(f.b)((function(e){return{metadata:e.metadata,patientMovement:e.patientMovement,sequence:e.sequence,graphSettings:e.graphSettings,graphObject:e.graphObject,graphClusters:e.graphClusters,colorLUT:e.colorLUT,isShowingLoadingModal:e.isShowingLoadingModal}}),(function(e){return Object(m.b)({changeMethodSetting:At,changeLayoutSetting:Ut,changeIsUserReDrawSetting:kt,changeEdgeFilterCutoffSetting:Rt,changeClusterMethodSetting:Pt,changeIsUserClusteringSetting:Gt,changeIsEdgeScaledSetting:qt,changeEdgeScaleFactorSetting:zt,changeColorNodeSetting:Vt,changeExportFormatSetting:Yt,changeIsUserDownloadingSetting:Wt,changeIsHideEdgesByCutoff:Ht,changeEdgesHideCutoff:Bt,changeTransIcludeLocLevel:Xt,changeTypeOfAnalysisSetting:$t,changeIsUserFilterEdgesSetting:Ft,changeIsUserRelayoutSetting:Zt,isShowingLoadingModalToStore:da},e)}))((function(e){var t=e.graphSettings.method,a=e.graphSettings.layout,r=e.graphSettings.isUserReDraw,i=e.graphSettings.isUserFilteringEdge,c=e.graphSettings.edgeFilterCutoff,o=e.graphSettings.clusterMethod,l=e.graphSettings.isUserClustering,d=e.graphSettings.isEdgeScaled,u=e.graphSettings.edgeScaleFactor,p=e.graphSettings.isHideEdgesByCutoff,f=e.graphSettings.hiddenEdgesCutoff,m=e.graphSettings.colorNodedBy,x=e.graphSettings.exportFormat,O=e.graphSettings.transIncludeLocLevel,y=e.graphSettings.typeOfAnalysis,v=e.graphSettings.isUserRelayout,S=function(t){e.changeMethodSetting(t)},_=function(e,t){return Object(n.jsx)(ua,{disabled:!1,value:e,children:e},t)};return Object(n.jsxs)(s.a.Fragment,{children:[Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{xs:24,id:"header-content",children:Object(n.jsx)(j.a,{visible:e.isShowingLoadingModal,closable:!1,centered:!0,width:0,footer:null,bodyStyle:{textAlign:"center",padding:"0px"},children:Object(n.jsx)(b.a,{indicator:pa,style:{color:"white"},tip:"Processing...",size:"large"})})})}),Object(n.jsxs)(h.a,{gutter:[8,8],children:[Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Graph settings"}),Object(n.jsxs)("p",{children:["Type of analysis"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Analysis to be performed. [1]Clustering: construct an undirected graph and detect putative cluster(s). [2]Transmission: construct a directed graph to show the putative transmission flow",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{disabled:!e.sequence,value:y,style:{width:"100%"},onChange:function(t){"clustering"===t?e.changeMethodSetting("cathai"):e.changeMethodSetting("seqtrack"),e.changeTypeOfAnalysisSetting(t)},children:[Object(n.jsxs)(ua,{disabled:!e.sequence,value:"clustering",children:[" ","Clustering"," "]}),Object(n.jsx)(ua,{disabled:!e.sequence||!e.metadata,value:"transmission",children:"Transmission"})]})]}),"clustering"===y&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Method"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Method to construct clustering graph.  [1] CATHAI: given the SNP cut-off, create networks of pairwise SNP-distances between samples (Forde et al. 2021)",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsx)(mt.a,{disabled:!e.sequence||!y,value:t,style:{width:"100%"},onChange:S,children:Object(n.jsx)(ua,{value:"cathai",children:"CATHAI"})})]}),"transmission"===y&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Method"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Method to construct transmission graph.  [1]SeqTrack: construct a parsimonous transmission tree based on SNP distances and sampling dates (Jombart et al. 2014).  [2]SNPs and patient stay: construct a directed graph where edges were weighted by sum of SNPs distance weight and patient stays",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsx)(mt.a,{disabled:!y,value:t,style:{width:"100%"},onChange:S,children:Object(n.jsx)(ua,{disabled:!e.sequence||!e.metadata,value:"seqtrack",children:"SeqTrack"})})]}),Object(n.jsxs)(g.a,{span:16,children:[Object(n.jsxs)("p",{children:["Layout"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Layout to display the graph.",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{disabled:!e.sequence,value:a,style:{width:"100%"},onChange:function(t){e.changeLayoutSetting(t)},children:[Object(n.jsx)(ua,{value:"cose",children:" CoSE"}),Object(n.jsx)(ua,{value:"spread",children:"Spread"}),Object(n.jsx)(ua,{value:"fcose",children:"fCoSE"})]})]}),Object(n.jsxs)(g.a,{span:8,children:[Object(n.jsxs)("p",{children:["Refresh"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Apply selected layout to current graph.",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsx)(je.a,{disabled:!e.graphObject,onClick:function(){v||(e.isShowingLoadingModalToStore(!0),e.changeIsUserRelayoutSetting(!0))},type:"primary",children:Object(n.jsx)(ia.a,{})})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsxs)(na.a,{style:{fontSize:"10px"},onChange:function(t){var a=t.target.checked;e.changeIsUserFilterEdgesSetting(a)},checked:i,disabled:!e.sequence||"clustering"!==y,children:["Apply SNPs cutoff"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Apply a cutoff number to limit the maximum pairwise SNPs distance to be displayed.",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]})}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Cutoff number"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Maximum pairwise SNPs distance to be included in graph  (e.g. 25 SNPs cutoff will include edges with 0 to 25 SNPs).",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsx)(ra.a,{min:0,disabled:!i||!e.sequence||"clustering"!==y,step:1,value:c,onChange:function(t){t>0&&e.changeEdgeFilterCutoffSetting(t)},style:{marginBottom:"5px"}})]}),"hierSnpsMetaStayOverlap"===t&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Filter weighted edges",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Filter edges based on its weight.  The weight is a combination score computed from pairwise SNP distances and stay overlap in hierarhical order. The weight assignation are:  #1 (all SNP distances),  #2 (#1+SNP distances less and equal to cutoff), #3 (#2+They had overlap stay at hospital level), #4 (#3+They had overlap stay at ward level), #5 (#4+They had overlap stay at bay level), and #6 (#5+They had overlap stay at bed level). So an edge with weight of #6 represents the highest score for a possible transmission based on their SNPs distance and stay overlap in bed level. *Stay overlap is considered in 7 days range (REF)",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{disabled:"hierSnpsMetaStayOverlap"!==t,value:O,style:{width:"100%"},onChange:function(t){e.changeTransIcludeLocLevel(t)},children:[Object(n.jsx)(ua,{value:1,children:"SNPs"}),Object(n.jsx)(ua,{value:2,children:"Hospital"}),Object(n.jsx)(ua,{value:3,children:"Ward"}),Object(n.jsx)(ua,{value:4,children:"Bay"}),Object(n.jsx)(ua,{value:5,children:"Bed"})]})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(je.a,{disabled:!e.sequence,onClick:function(){r||(e.isShowingLoadingModalToStore(!0),e.changeIsUserReDrawSetting(!0))},type:"primary",children:"Create graph"})}),"clustering"===y&&e.graphObject&&Object(n.jsx)(sa.a,{style:{margin:"10px 0px 0px 0px"}}),"clustering"===y&&e.graphObject&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Clustering settings"}),Object(n.jsxs)("p",{children:["Method"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Method to detect cluster in the constructed graph. [1]Connected components: using Breadth-first search algorithm (Zhou and Hansen,2006) to find cluster (all connected nodes) [2]Louvain: using Louvain algoritm (Subelj and Bajec, 2011) to find the cluster(s) ",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{disabled:!e.graphObject,value:o,style:{width:"100%"},onChange:function(t){e.changeClusterMethodSetting(t)},children:[Object(n.jsx)(ua,{value:"Connected Components",children:"Connected Components"}),Object(n.jsx)(ua,{value:"Louvain",children:"Louvain"})]})]}),"clustering"===y&&e.graphObject&&Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(je.a,{type:"primary",disabled:!e.graphObject,onClick:function(){l||e.changeIsUserClusteringSetting(!0)},children:"Detect clusters"})}),Object(n.jsx)(sa.a,{style:{margin:"10px 0px 0px 0px"}}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Visualization settings"}),Object(n.jsxs)(na.a,{style:{fontSize:"10px"},onChange:function(t){var a=t.target.checked;e.changeIsEdgeScaledSetting(a)},checked:d,disabled:!e.graphObject,children:["Scale edge to its weight"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Change the thickness of the edge accordin to its weight. (e.g. the higher the transmission score the thicker the line).",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]})]}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Scaling factor"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Multiply the thickness of the edge with the scaling factor (positive number greater than zero)",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsx)(ra.a,{min:1e-5,disabled:!d||!e.graphObject,step:.1,value:u,onChange:function(t){t>0&&e.changeEdgeScaleFactorSetting(t)}})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsxs)(na.a,{style:{fontSize:"10px"},onChange:function(t){var a=t.target.checked;e.changeIsHideEdgesByCutoff(a)},checked:p,disabled:!e.graphObject,children:["Show partial edges"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Only show edges which have weight within the specified range (min to max) (Note: It doesn't remove the edges but only hide it to the background)",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]})}),Object(n.jsxs)(g.a,{span:12,children:[Object(n.jsx)("p",{children:"Minimum"}),Object(n.jsx)(ra.a,{min:0,disabled:!p||!e.graphObject,step:.1,value:f.min,onChange:function(t){if(t>=0){var a={min:t,max:f.max};e.changeEdgesHideCutoff(a)}}})]}),Object(n.jsxs)(g.a,{span:12,children:[Object(n.jsx)("p",{children:"Maximum"}),Object(n.jsx)(ra.a,{min:0,disabled:!p||!e.graphObject,step:.1,value:f.max,onChange:function(t){if(t>0){var a={min:f.min,max:t};e.changeEdgesHideCutoff(a)}}})]}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Node color"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Color nodes by the selected column in metadata or by the clustering result. User can also specify the color manually (e.g. To specify color on column 'patient_group', add new column named 'patient_group:color' in metadata).",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{disabled:!e.graphObject,value:m,style:{width:"100%"},onChange:function(t){e.changeColorNodeSetting(t)},children:[" ",e.colorLUT&&Object.keys(e.colorLUT)?Object.keys(e.colorLUT).map((function(e,t){return _(e,t)})):["na"].map((function(e,t){return _(e,t)}))]})]}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Download settings"}),Object(n.jsxs)("p",{children:["Type"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Type of file to be downloaded:  [1]Graph image (SVG) [2]Graph object file (DOT format: suitable for visualization with HAIviz) [3]Clustering result (CSV).",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{value:x,style:{width:"100%"},onChange:function(t){e.changeExportFormatSetting(t)},disabled:!e.graphObject&&!e.graphClusters,children:[Object(n.jsx)(ua,{disabled:!e.graphObject,value:"svg",children:"Graph image (SVG)"}),Object(n.jsx)(ua,{disabled:!e.graphObject,value:"dot",children:"Graph file (DOT)"}),Object(n.jsx)(ua,{disabled:!e.graphClusters,value:"clusterID",children:"Clustering result (CSV)"})]})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(je.a,{disabled:!e.graphClusters&&!e.graphObject,onClick:function(){switch(x){case"clusterID":(t=e.graphClusters.members)&&new ca.ExportToCsv({fieldSeparator:",",filename:"GraphSNP_clusterID",quoteStrings:'"',decimalSeparator:".",showLabels:!0,showTitle:!1,useTextFile:!1,useBom:!0,useKeysAsHeaders:!0}).generateCsv(t);break;case"svg":e.changeIsUserDownloadingSetting(!0);break;case"dot":!function(e){var t=-1!==["hierSnpsMetaStayOverlap"].indexOf(e.creator),a=e.nodes,n=e.edges,r=new oa({multigraph:!0});Array.isArray(a)&&a.length>0&&a.forEach((function(e){r.setNode(e)})),Array.isArray(n)&&n.length>0&&n.forEach((function(e){var a=e.source,n=e.target,s=0===e.value||e.value?e.value:"null",i=t?"forward":"none";r.setEdge(a,n,{weight:s,dir:i})})),Ze("Graph_in_DOT.gv",la.write(r))}(e.graphObject)}var t},type:"primary",children:"Download"})})]})]})})),ga=a(355);function ja(e,t){this.nodes=e,this.edges=t}ja.prototype.getSymetricEdges=function(){var e=this.edges;return e=e.filter((function(e){return"upper"===e.part})),new ja(this.nodes,e)},ja.prototype.getEdgesLowerThanCutoff=function(e){var t=this.edges;return e&&e>0&&(t=t.filter((function(t){return t.value<e}))),new ja(this.nodes,t)},ja.prototype.getEdgesGreaterThanCutoff=function(e){var t=this.edges;return e&&e>0&&(t=t.filter((function(t){return t.value>e}))),new ja(this.nodes,t)};var ba=ja,fa=a(21);var ma=a(21);var xa=a(21);function Oa(e){this.stays=e}Oa.prototype.getRangeOfStays=function(){var e,t;return Array.isArray(this.stays)&&this.stays.length>0&&this.stays.forEach((function(a){e=e?e>a.start_date?a.start_date:e:a.start_date,t=t?t<a.end_date?a.end_date:t:a.end_date})),{start_date:e,end_date:t}},Oa.prototype.getLocationLevel=function(){var e;return Array.isArray(this.stays)&&this.stays.length>0&&this.stays.forEach((function(t){var a=Ke(t);e?a>e&&(e=a):e=a})),e};var ya=Oa,va=Object(ke.extendMoment)(Ue.a),Sa=a(21);function _a(e,t,a,n,r){for(var s=0,i=a.stays.filter((function(e){return Ke(e)===r})),c=n.stays.filter((function(e){return Ke(e)===r})),o=0;o<i.length;o++)for(var l=i[o],d=va.range(l.start_date.startOf("day"),l.end_date.endOf("day")),u=0;u<c.length;u++){var p=c[u],h=va.range(p.start_date.startOf("day"),p.end_date.endOf("day"));if(d.overlaps(h))if(d.intersect(h).diff("days")<=7){var g=Qe(l,p);g>s&&(s=g)}}return s}var Ta=a(21),wa=Object(ke.extendMoment)(Ue.a),Ea=a(1167);function Da(e,t,a,n,r,s,i,c){var o={creator:null,nodes:null,edges:null};switch(t){case"mcg":var l=function(e,t){var a=fa.cloneDeep(e),n=[],r=[];a.forEach((function(e,a){r.push(a);for(var s=e.sort((function(e,t){return e.value-t.value})),i=s[0].value,c=0,o=0;o<s.length;o++){if(s[o].value!==i){c=o;break}c=o}c>0&&s.splice(c),null!==t&&t>0&&(s=s.filter((function(e){return e.value<=t}))),n=n.concat(s)}));var s=new ba(r,n).getSymetricEdges();return{nodes:s.nodes,edges:s.edges}}(e,a);o.creator="mcg",o.nodes=l.nodes,o.edges=l.edges;break;case"cathai":var d=function(e,t){var a=ma.cloneDeep(e),n=[],r=[];a.forEach((function(e,a){r.push(a);var s=e;null!==t&&t>0&&(s=s.filter((function(e){return e.value<=t}))),n=n.concat(s)}));var s=new ba(r,n).getSymetricEdges();return{nodes:s.nodes,edges:s.edges}}(e,a);o.creator="cathai",o.nodes=d.nodes,o.edges=d.edges;break;case"cge":var u=function(e,t,a){var n=xa.cloneDeep(e),r=[],s=[];n.forEach((function(e,t){s.push(t);for(var a=e.sort((function(e,t){return e.value-t.value})),n=a[0].value,i=0,c=0;c<a.length;c++){if(a[c].value!==n){i=c;break}i=c}a.splice(i),r=r.concat(a)}));var i=new ba(s,r).getSymetricEdges(),c=i.edges;return c.forEach((function(e){e.value=1,null!==a&&e.value<=a&&(e.value=e.value+1),t.forEach((function(t,a){-1!==t.indexOf(e.source)&&-1!==t.indexOf(e.target)&&(e.value=e.value+1)}))})),{nodes:i.nodes,edges:c}}(e,n,a);o.creator="cge",o.nodes=u.nodes,o.edges=u.edges;break;case"seqtrack":var p=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=Ta.cloneDeep(e),s=[];t.forEach((function(e,t){s.push({id:t,date:e.sample_date})}));for(var i=!1,c=0;c<s.length;c++){var o=s[c];if(!r.has(o.id)){i=!0,alert("Case id in metadata is not consistent with taxa id in alignment:"+o.id);break}}function l(e,r){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;if(r.length>1){var o=r.map((function(e){return e.date=wa(c.get(e.id).sample_date),e})).sort((function(e,t){return e.date>t.date}));if(n&&s){console.log("with mutation");var l=wa(e.date),d=o.map((function(e){var t=l.diff(e.date,"days"),a=Ea(e.snpDist,t*s,i);return e.dayDiff=t,e.probability=a,e})).sort((function(e,t){return e.probability<t.probability}))[0];return{ances:d.id,snpDist:d.snpDist}}var u=o[0];return{ances:u.id,snpDist:u.snpDist}}}function d(e,t,a){for(var n=[],r=0;r<t.length;r++){var s=t[r].id,i=a.get(s).filter((function(t){return t.target===e.id}));n.push({id:s,snpDist:i[0].value})}return n.sort((function(e,t){return e.snpDist-t.snpDist})),n.filter((function(e){return e.snpDist===n[0].snpDist}))}function u(e,t,a){var n={ances:null,snpDist:null},r=t.filter((function(t){return t.date<e.date}));if(0===r.length)return n.ances="NA",n.snpDist="NA",n;if(1===r.length){n.ances=r[0].id;var s=a.get(r[0].id).filter((function(t){return t.target===e.id}));return n.snpDist=s[0].value,n}var i=d(e,r,a);if(i.length>1){var c=l(e,i);return n.ances=c.ances,n.snpDist=c.snpDist,n}return n.ances=i[0].id,n.snpDist=i[0].snpDist,n}if(i){return{nodes:null,edges:null}}for(var p=new Map,h=0;h<s.length;h++){var g=s[h],j=u(g,s,r);p.set(g.id,j)}var b={nodes:[],edges:[]};return p.forEach((function(e,t){b.nodes.push(t),"NA"!==e.ances&&b.edges.push({source:e.ances,target:t,value:e.snpDist,dir:"forward"})})),b}(e,s,c);o.creator="seqtrack",o.nodes=p.nodes,o.edges=p.edges;break;case"hierSnpsMetaStayOverlap":var h=function(e,t,a,n,r){var s=Sa.cloneDeep(e),i=Sa.cloneDeep(a),c=[],o=[];s.forEach((function(e,a){o.push(a);var n=e;null!==t&&t>0&&(n=n.filter((function(e){return e.value<=t}))),c=c.concat(n)}));var l=[],d=[];if(c.length>0)for(var u=0;u<c.length;u++){var p=c[u],h=n.get(p.source).patient_id,g=n.get(p.target).patient_id,j=va(n.get(p.source).sample_date),b=va(n.get(p.target).sample_date),f=i.get(h)?new ya(i.get(h)):null,m=i.get(g)?new ya(i.get(g)):null;if(f instanceof ya&&m instanceof ya&&Array.isArray(f.stays)&&Array.isArray(m.stays)&&f.stays.length>0&&m.stays.length>0){var x=f.getLocationLevel(),O=m.getLocationLevel(),y=Math.min(x,O)?Math.min(x,O):null;if(y){var v=f.getRangeOfStays(),S=m.getRangeOfStays(),_=va.range(v.start_date.startOf("day"),v.end_date.endOf("day")),T=va.range(S.start_date.startOf("day"),S.end_date.endOf("day"));if(_.overlaps(T))if(b.isAfter(j,"day")){var w=_a(0,0,f,m,y);p.dir="forward",p.value=1+w,l.push(p)}else p.dir="none",p.value=1,d.push(p);else p.dir="none",p.value=1,d.push(p)}else p.dir="none",p.value=1,d.push(p)}else p.dir="none",p.value=1,d.push(p)}return l=l.filter((function(e){return e.value>=r})),{nodes:o,edges:l}}(e,a,r,s,i);o.creator="hierSnpsMetaStayOverlap",o.nodes=h.nodes,o.edges=h.edges}return o}function Ca(e,t,a){var n,r,s,i,c=[],o=[];for(c.push(e),a[e]=!0;c.length>0;)for(e=c.shift(),o.push(e),n=0,r=(s=t[e]).length;n<r;n+=1)a[i=s[n]]||(c.push(i),a[i]=!0);return o}var Ia=a(1333);function La(e,t){var a=null;switch(t){case"Connected Components":a=function(e){var t,a=e.nodes,n=function(e){var t,a,n,r,s,i={};for(t=0,a=e.length;t<a;t+=1)r=(n=e[t]).source,s=n.target,i[r]?i[r].push(s):i[r]=[s],i[s]?i[s].push(r):i[s]=[r];return i}(e.edges),r=[],s={};for(t in n)n.hasOwnProperty(t)&&!s[t]&&r.push(Ca(t,n,s));var i=[];r=r.sort((function(e,t){return t.length-e.length}));var c=[];return r.forEach((function(e,t){Array.isArray(e)&&e.length>0&&e.forEach((function(e){c.push(e),i.push({sample:e,clusterID:t+1})}))})),a.forEach((function(e){-1===c.indexOf(e)&&i.push({sample:e,clusterID:"na"})})),console.log(i),{group:r,members:i}}(e);break;case"Louvain":a=function(e){var t=e.edges,a=e.nodes,n=[];t.forEach((function(e){n.push(e.source,e.target)})),n=n.filter(Ve);var r=new Map,s=[],i=Ia.jLouvain().nodes(n).edges(t)(),c=[];for(var o in i){c.push(o);var l=i[o]+1;if(s.push({sample:o,clusterID:l}),r.get(l)){var d=r.get(l);d.push(o),r.set(l,d)}else r.set(l,[o])}var u=[];return r.forEach((function(e,t){u.push(e)})),a.forEach((function(e){-1===c.indexOf(e)&&s.push({sample:e,clusterID:"na"})})),{group:u,members:s}}(e)}return a}var Na=a(204),Ma=a.n(Na),Aa=a(560),Ua=a.n(Aa),ka=a(21),Ra=a(1337),Fa=a(1340);Ma.a.use(Ra),Ma.a.use(Fa),Ma.a.use(Ua.a);var Pa=Object(f.b)((function(e){return{metadata:e.metadata,patientMovement:e.patientMovement,sequence:e.sequence,graphObject:e.graphObject,hammMatrix:e.hammMatrix,graphSettings:e.graphSettings,colorLUT:e.colorLUT,graphClusters:e.graphClusters,categoricalMap:e.categoricalMap}}),(function(e){return Object(m.b)({changeIsUserClusteringSetting:Gt,changeIsUserReDrawSetting:kt,hmmMatrixToStore:we,graphObjectToStore:Ee,graphClusterToStore:De,colorLUTtoStore:gt,changeIsUserDownloadingSetting:Wt,changeChartSessionSetting:Jt,changeIsUserLoadSessionSetting:Kt,changeSelectedNode:Qt,isShowingLoadingModalToStore:da,changeIsUserRelayoutSetting:Zt},e)}))((function(e){var t=Object(r.useState)(!1),a=Object(It.a)(t,2),i=a[0],c=a[1],o=Object(r.useState)(!1),l=Object(It.a)(o,2),d=l[0],u=l[1],p=(e.graphSettings.typeOfAnalysis,e.graphSettings.method),h=e.graphSettings.layout,j=e.graphSettings.isUserReDraw,b=e.graphSettings.isUserFilteringEdge?e.graphSettings.edgeFilterCutoff:null,f=e.graphSettings.clusterMethod,m=e.graphSettings.isUserClustering,x=e.graphSettings.isHideEdgesByCutoff,O=e.graphSettings.hiddenEdgesCutoff,y=e.graphSettings.colorNodedBy,v=e.graphSettings.isEdgeScaled,S=e.graphSettings.edgeScaleFactor,_=e.graphSettings.isUserDownloading,T=e.graphSettings.transIncludeLocLevel,w=e.graphSettings.isUserRelayout,E={name:h,animate:!1,fit:!0},D=Object(r.useRef)(null),C=e.graphSettings.chartSession,I=e.graphSettings.isUserReloadSession;Object(r.useEffect)((function(){j&&setTimeout((function(){!function(){var t=e.hammMatrix?e.hammMatrix:new at(e.sequence).getHammingMatrix(),a=e.sequence?e.sequence[0].size:null,n=Da(t,p,b,e.categoricalMap,e.patientMovement,e.metadata,T,a);if(n&&n.nodes&&n.edges){var r=function(e){var t=e.creator,a=e.nodes,n=e.edges,r=[];return n.forEach((function(e){r.push({data:{source:e.source,target:e.target,weight:e.value,dir:"forward"===e.dir?"forward":"none"}})})),a.forEach((function(e){var a="nlv"===t?e.data:[],n="nlv"===t?"compound":"singleton";r.push({data:{id:e,nodeType:n,data:a}})})),r}(n);if(r){if(C)C.unmount();var s=Ma()({elements:r,container:document.getElementById("graph-cont-cytoscape-canvas"),pannable:!0,selected:!0,boxSelectionEnabled:!1,style:[{selector:"node",style:{label:"data(id)","border-width":3,"border-style":"solid","border-color":"black","background-color":function(t){return y&&e.colorLUT?Xe(t.data("id"),y,e.colorLUT):"lightgray"}}},{selector:"edge",style:{opacity:function(e){var t=e.data("weight");return x&&(t<O.min||t>O.max)?0:1},label:"data(weight)","font-size":"10px","text-background-color":"#F5E372",color:"red",width:function(e){return $e(v,e.data("weight"),S,"edge")},"target-arrow-color":"black","target-arrow-shape":function(e){return"forward"===e.data("dir")?"triangle":"none"},"curve-style":"bezier","arrow-scale":function(e){return $e(v,e.data("weight"),S,"arrow")}}},{selector:":selected",style:{"border-width":"5","border-color":"red","border-style":"dashed",padding:"8px"}}]});if("spread"===h){var i={name:"cose",animate:!1,fit:!0,prelayout:!1};s.layout(i).run()}else s.layout(E).run();s.selectionType("single"),s.nodes().bind("tap",(function(t){if(e.metadata){var a=[t.target.data("id")];e.changeSelectedNode(a)}})),s.on("tap",(function(t){t.target===s&&e.changeSelectedNode([])})),D.current=s,e.hammMatrix&&e.hmmMatrixToStore(t),e.graphObjectToStore(n),e.changeChartSessionSetting(s)}}}(),c(!0),e.changeIsUserReDrawSetting(!1),e.isShowingLoadingModalToStore(!1)}),100)}),[j]),Object(r.useEffect)((function(){I&&setTimeout((function(){!function(){var e=C;e.unmount(),e.mount(document.getElementById("graph-cont-cytoscape-canvas")),D.current=e}(),c(!0),e.changeIsUserLoadSessionSetting(!1),e.isShowingLoadingModalToStore(!1)}),100)}),[I]),Object(r.useEffect)((function(){_&&(Ze("GraphSNP-cytoscape-svg.svg",D.current.svg({scale:1,full:!0})),e.changeIsUserDownloadingSetting(!1))}),[_]),Object(r.useEffect)((function(){m&&e.graphObject&&(u(!0),setTimeout((function(){var t=La(e.graphObject,f);u(!1),ge.b.success("Found ".concat(t.group.length," clusters in the graph"),2);var a=Ye(t.members,"clusterID"),n=ka.cloneDeep(e.colorLUT);n?n=Object(ga.a)(Object(ga.a)({},n),{},{clusterID:a}):n={clusterID:a};e.colorLUTtoStore(n),e.graphClusterToStore(t),e.changeIsUserClusteringSetting(!1)}),100))}),[f,m]),Object(r.useEffect)((function(){w&&D.current&&setTimeout((function(){var t=D.current,a={name:h,animate:!1,fit:!0,prelayout:!1};t.layout(a).run(),D.current=t,e.isShowingLoadingModalToStore(!1),e.changeIsUserRelayoutSetting(!1)}),100)}),[w]),Object(r.useEffect)((function(){if(e.graphObject&&D.current){var t=D.current;v?(t.style().selector("edge").style({width:function(e){return $e(v,e.data("weight"),S,"edge")},"arrow-scale":function(e){return $e(v,e.data("weight"),S,"arrow")}}).update(),D.current=t):(t.style().selector("edge").style({width:3,"arrow-scale":1}).update(),D.current=t)}}),[v,S]),Object(r.useEffect)((function(){if(e.graphObject&&D.current){var t=D.current;x?(t.style().selector("edge").style({opacity:function(e){var t=e.data("weight");return x&&(t<O.min||t>O.max)?0:1}}).update(),D.current=t):(t.style().selector("edge").style({opacity:1}).update(),D.current=t),D.current=t}}),[x,O]),Object(r.useEffect)((function(){if(y&&e.colorLUT&&D.current){var t=D.current;t.style().selector("node").style({"background-color":function(t){return Xe(t.data("id"),y,e.colorLUT)}}).update(),D.current=t}}),[y,e.colorLUT]);return Object(n.jsxs)(s.a.Fragment,{children:[Object(n.jsxs)(g.a,{span:24,style:{position:"relative"},children:[Object(n.jsx)("div",{id:"graph-cont-is-empty",style:{display:i?"none":"block"},children:Object(n.jsx)(Ct.a,{description:C?"Reload previous graph":"No graph. Create one",image:Ct.a.PRESENTED_IMAGE_SIMPLE,children:C&&Object(n.jsx)(je.a,{onClick:function(t){I||(e.isShowingLoadingModalToStore(!0),e.changeIsUserLoadSessionSetting(!0))},type:"primary",children:Object(n.jsx)(ia.a,{})})})}),Object(n.jsx)("div",{id:"graph-cont-is-processing",style:{display:d?"block":"none"},children:Object(n.jsxs)("p",{style:{textAlign:"right"},children:[Object(n.jsx)("span",{children:Object(n.jsx)(pe.a,{style:{fontSize:18},spin:!0})})," ","Creating graph ..."]})})]}),Object(n.jsx)("div",{id:"graph-cont-cytoscape-canvas"})]})})),Ga=Dt.a.Sider,qa=Dt.a.Content;var za=Object(f.b)((function(e){return{hammingMatrix:e.hammMatrix}}),(function(e){return Object(m.b)({},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(Dt.a,{children:[Object(n.jsx)(Ga,{id:"graphsnp-sider",children:Object(n.jsx)(ha,{})}),Object(n.jsxs)(Dt.a,{id:"graphsnp-container",children:[e.hammingMatrix&&Object(n.jsxs)(qa,{children:[Object(n.jsx)(aa,{}),Object(n.jsx)(Pa,{})]}),!e.hammingMatrix&&Object(n.jsx)(qa,{children:Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)("div",{id:"graph-cont-is-empty",style:{display:"block"},children:Object(n.jsx)(Ct.a,{description:"No input: Load one.",image:Ct.a.PRESENTED_IMAGE_SIMPLE})})})})]})]})})})),Ha=a(1375),Ba=a(126),Va=(a(249),Ha.a.Title),Ya=Ha.a.Text,Wa=function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{className:"graphsnp-docs-content",children:[Object(n.jsxs)(Va,{level:2,underline:!0,children:[" ","GraphSNP: What is it?"," "]}),Object(n.jsx)(Ya,{children:"GraphSNP is a web-based application to create and visualise network of pairwise SNP distances for outbreak cluster and transmission analysis. It is a client-side and standalone version of integrated cluster analysis platform CATHAI: Cluster Analysis for Healthcare Associated Infection (REF:Forde et al., 2021)"}),Object(n.jsx)(Va,{level:3,children:"When to use "}),Object(n.jsx)(Ya,{children:"You can use GraphSNP for:"}),Object(n.jsxs)("ul",{children:[Object(n.jsxs)("li",{children:["Rapid outbreak network visualization:"," ",Object(n.jsx)("b",{children:"No instalation required, drag and drop input files, interactive and easy to use."})]}),Object(n.jsxs)("li",{children:[" ",Object(n.jsx)("b",{children:"Visualize distribution "})," of pairwise SNP distances from a multi-fasta SNPs aligment"," "]}),Object(n.jsxs)("li",{children:[" ",Object(n.jsx)("b",{children:"Create network "}),"of pairwise SNP distances and"," ",Object(n.jsx)("b",{children:"apply SNPs cutoff "}),"for cluster analysis"]}),Object(n.jsxs)("li",{children:[Object(n.jsx)("b",{children:"Automatic cluster detection "})," based on community detection algorithms"]}),Object(n.jsxs)("li",{children:[" ",Object(n.jsx)("b",{children:"Create transmission tree "})," based on SNPs, sampling dates, and patient stay timeline (for nosocomial outbreak)"," "]})]}),Object(n.jsx)(Va,{level:3,children:"How to use "}),Object(n.jsxs)(Ya,{children:["Simple, have at least a multi-fasta SNPs alignment file as the input file then drag and drop it to",Object(n.jsxs)(Ba.a,{to:"/graphsnp",onClick:function(){e.changeNavLocation("graphsnp")},children:[" ","GraphSNP page."]})," ","You can also add other information like metadata and patient stay timeline to the analysis."]}),Object(n.jsx)(sa.a,{})]})})},Xa=Ha.a.Title,$a=(Ha.a.Paragraph,Ha.a.Text),Ja=function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{className:"graphsnp-docs-content",children:[Object(n.jsxs)(Xa,{level:2,underline:!0,children:[" ","Input file(s)"," "]}),Object(n.jsx)(Xa,{level:3,children:"A multi-fasta SNPs alignment"}),Object(n.jsx)($a,{children:"SNPs alignment file must contain at least two equally length of fasta-formatted non-gap nucleotide sequences."}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(je.a,{type:"primary",href:le,children:"Download SNPs example file"}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(Xa,{level:3,children:"Metadata table"}),Object(n.jsx)($a,{children:"Metadata table must contain at least three non-empty columns: sampleID, sampleDate, and sampleSource. Sample identifier must be identical on both metadata and SNPs alignment."}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(je.a,{type:"primary",href:de,children:"Download metadata example file"}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{})]})})},Ka=Ha.a.Title,Qa=Ha.a.Text,Za=function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{className:"graphsnp-docs-content",children:[Object(n.jsxs)(Ka,{level:2,underline:!0,children:["Browser compatibility"," "]}),"GraphSNP was boostrapped using Create React App (CRA) tool and so it works on majority of modern browsers. Except Internet Explorer (IE), GraphSNP was tested and compatible on the following desktop browsers:",Object(n.jsxs)("ul",{children:[Object(n.jsx)("li",{children:" Microsoft Edge (v.xx) "}),Object(n.jsx)("li",{children:" Safari (v.xx)"}),Object(n.jsx)("li",{children:" Chrome (v.xx) "}),Object(n.jsx)("li",{children:" Firefox (v.90.0)"}),Object(n.jsx)("li",{children:" Opera (v.xx) "})]}),Object(n.jsx)(Ka,{level:3,children:"Core libraries"}),Object(n.jsxs)(Qa,{children:["Thanks to all the frameworks and libraries run on the background, GraphSNP is now up and running and available worldwide. These are some of key frameworks and libraries used by GraphSNP:",Object(n.jsxs)("ul",{children:[Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://reactjs.org/",target:"_blank",rel:"noopener noreferrer",children:"React.js"})}),Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://d3js.org/",target:"_blank",rel:"noopener noreferrer",children:"Data-Driven Documents (D3.js)"})}),Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://ant.design/",target:"_blank",rel:"noopener noreferrer",children:"Ant design UI"})}),Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://js.cytoscape.org/",target:"_blank",rel:"noopener noreferrer",children:"Cytoscape"})}),Object(n.jsx)("li",{children:"Create React App, cytoscape-svg, dotparser, export-to-csv, lodash, moment, moment-range, react-color, react-faux-dom, react-measure, react-player, redux, react router etc."})]})]}),Object(n.jsx)(Ka,{level:3,children:"Have any questions? "}),Object(n.jsxs)(Qa,{children:["Please feel free to send it to my email:"," ",Object(n.jsx)("span",{style:{weight:"bold",color:"blue"},children:"b.permana@uq.edu.au"})]}),Object(n.jsxs)(Ka,{level:2,underline:!0,children:["Cite us"," "]}),Object(n.jsx)(Qa,{children:"If you use GraphSNP in your publication, please cite our papers [available soon] and [CATHAI paper]"}),Object(n.jsx)(sa.a,{})]})})};var en=Object(f.b)(null,(function(e,t){return Object(m.b)({changeNavLocation:ue},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(Dt.a,{id:"page-documentation",children:[Object(n.jsx)(Wa,{changeNavLocation:e.changeNavLocation}),Object(n.jsx)(Ja,{}),Object(n.jsx)(Za,{})]})})}));a(530);function tn(e){return{type:K,payload:e}}function an(e){return{type:Q,payload:e}}function nn(e){return{type:Z,payload:e}}function rn(e){return{type:ee,payload:e}}function sn(e){return{type:ne,payload:e}}function cn(e){return{type:re,payload:e}}function on(e){return{type:se,payload:e}}function ln(e){return{type:ie,payload:e}}function dn(e){return{type:ce,payload:e}}var un=mt.a.Option,pn=Object(n.jsx)(pe.a,{style:{fontSize:34},spin:!0});var hn=Object(f.b)((function(e){return{snpDistSettings:e.snpDistSettings,hammingMatrix:e.hammMatrix,colorLUT:e.colorLUT,metadata:e.metadata,isShowingLoadingModal:e.isShowingLoadingModal}}),(function(e){return Object(m.b)({dist_changeDataToDisplay:tn,dist_changeDataColumn:an,dist_changeDataColumnLevel:nn,dist_changeChartOrientation:rn,dist_changeExportFormat:sn,dist_changeIsUserDraw:cn,dist_changeIsUserExport:on},e)}))((function(e){var t=e.metadata?Array.from(e.metadata.values()):null,a=e.snpDistSettings.dataToDisplay,r=e.snpDistSettings.dataColumn,i=e.snpDistSettings.dataColumnLevel,c=(e.snpDistSettings.chartOrientation,e.snpDistSettings.snpDistExportFormat),o=e.snpDistSettings.isUserDrawChart,l=e.snpDistSettings.isUserExportSnpDist;return Object(n.jsxs)(s.a.Fragment,{children:[Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{xs:24,id:"header-content",children:Object(n.jsx)(j.a,{visible:e.isShowingLoadingModal,closable:!1,centered:!0,width:0,footer:null,bodyStyle:{textAlign:"center",padding:"0px"},children:Object(n.jsx)(b.a,{indicator:pn,style:{color:"white"},tip:"Processing...",size:"large"})})})}),Object(n.jsxs)(h.a,{gutter:[8,8],children:[Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Visualization settings"}),Object(n.jsxs)("p",{children:["Select samples"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Select group of sample for bar chart visualization.",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{value:a,style:{width:"100%"},disabled:!e.hammingMatrix,onChange:function(t){e.dist_changeDataToDisplay(t)},children:[Object(n.jsx)(un,{value:"all",children:"All samples"}),Object(n.jsx)(un,{disabled:!e.metadata,value:"per-category",children:"Specific group (metadata)"})]})]}),"per-category"===a&&e.hammingMatrix&&e.metadata&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Select metadata column"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Column in metadata which group of sample to be displayed",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsx)(mt.a,{value:r,style:{width:"100%"},disabled:"per-category"!==a||!e.hammingMatrix||!e.metadata,onChange:function(t){e.dist_changeDataColumn(t)},children:e.colorLUT&&Object.keys(e.colorLUT)?Object.keys(e.colorLUT).map((function(e,t){return function(e,t){if(-1===["sample_date","patient_id"].indexOf(e))return Object(n.jsx)(un,{disabled:!1,value:e,children:e},t)}(e,t)})):["na"].map((function(e,t){return Object(n.jsx)(un,{disabled:!1,value:e,children:e},t)}))})]}),"per-category"===a&&r&&e.metadata&&t&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Select group"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Categorical group from the selected metadata column",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsx)(mt.a,{value:i,style:{width:"100%"},disabled:!("all"!==a&&r&&e.metadata&&t),onChange:function(t){e.dist_changeDataColumnLevel(t)},children:r&&t?function(e,t){if(e&&t){var a=e.map((function(e){return e[t]})).filter(Ve);return Array.isArray(a)&&a.length>0?(a.unshift("INTER-Group"),a.unshift("INTRA-Group"),a):["#na_exluded!"]}return["#na_exluded!"]}(t,r).map((function(e,t){return function(e,t){if(-1===["#na_exluded!"].indexOf(e))return Object(n.jsx)(un,{disabled:!1,value:e,children:e},t)}(e,t)})):["na"].map((function(e,t){return Object(n.jsx)(un,{disabled:!1,value:e,children:e},t)}))})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(je.a,{disabled:!e.hammingMatrix,onClick:function(t){o||e.dist_changeIsUserDraw(!0)},type:"primary",children:"Create Bar chart"})}),Object(n.jsx)(sa.a,{style:{margin:"10px 0px 0px 0px"}}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Download settings"}),Object(n.jsxs)("p",{children:["Type"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Type of file to be downloaded: Table of pairwise SNP distances (CSV) or Displayed bar chart (SVG)",placement:"rightTop",children:Object(n.jsx)(xe.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(mt.a,{disabled:!e.hammingMatrix,value:c,onChange:function(t){e.dist_changeExportFormat(t)},style:{width:"100%"},children:[Object(n.jsx)(un,{disabled:!e.hammingMatrix,value:"symSnpDist",children:"Table of pairwise SNP distances (CSV)"}),Object(n.jsx)(un,{value:"barChartSvg",children:"Bar chart (SVG)"})]})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(je.a,{disabled:!e.hammingMatrix,onClick:function(t){console.log("downlaod handlers"),l||e.dist_changeIsUserExport(!0)},type:"primary",children:"Download"})})]})]})})),gn=a(1373),jn=a(172),bn=a(1371),fn=a(352),mn=a(353),xn=a(574),On=a(1369),yn=a(1370),vn=a(1379),Sn=a(1354),_n=a(1385);function Tn(e,t,a,n,r,s,i,c){var o=n.length,l=parseFloat(fn.a(n)).toFixed(0),d=parseFloat(mn.a(n)).toFixed(0),u=parseFloat(xn.a(n,.25)).toFixed(1),p=parseFloat(xn.a(n,.75)).toFixed(1),h=parseFloat(On.a(n)).toFixed(1),g=parseFloat(yn.a(n)).toFixed(1),j=r,b=s-30,f=vn.a(n,(function(e){return e.length}),(function(e){return e})),m=Array.from(f.entries()),x=Array.from(f.keys()),O=Array.from(f.values()),y=jn.a().range([b,0]),v=bn.a().range([0,j]),S=j/(Sn.a(0,mn.a(x)).length+1),_=y;_.domain([0,mn.a(O)]);var T=v;T.domain(Sn.a(0,mn.a(x)+1));var w=_n.b().scale(_),E=_n.a().scale(T).tickValues(function(e){var t=e.length;return t<=10?e.filter((function(e,t){return!(t%1)})):t>10&&t<=100?e.filter((function(e,t){return!(t%5)})):t>100&&t<=1e3?e.filter((function(e,t){return!(t%25)})):t>1e3&&t<=1e4?e.filter((function(e,t){return!(t%50)})):t>1e4?e.filter((function(e,t){return!(t%100)})):void 0}(T.domain())),D={dataColumn:e,dataColumnLevel:t,type:"regular",w:r,h:s,margin:i,data_len:o,data_min:l,data_max:d,data_q1:u,data_q3:p,data_median:h,data_mean:g,margin_stats:30,cont_bar_w:j,cont_bar_h:b,barData:m,bar_bandWidth:S,bar_linear_scale_x:_,bar_band_scale_y:T,bar_axis_x:w,bar_axis_y:E};wn(a,D),c(D)}function wn(e,t){var a=t.dataColumn,n=t.dataColumnLevel,r=t.w,s=t.h,i=t.margin,c=t.data_len,o=t.data_min,l=t.data_max,d=t.data_q1,u=t.data_q3,p=t.data_median,h=t.data_mean,g=t.margin_stats,j=t.cont_bar_w,b=t.cont_bar_h,f=t.barData,m=t.bar_bandWidth,x=t.bar_linear_scale_x,O=t.bar_band_scale_y,y=t.bar_axis_x,v=t.bar_axis_y;e.attr("width",r+i.left+i.right).attr("height",s+i.top+i.bottom);var S=e.append("g").attr("id","snpdist_svgGroup").attr("transform","translate("+i.left+","+i.top+")scale(1)"),_=["Pairwise SNP-distances: (n=",c,"); "," Min: ",o,", Q1:",d,", Mean:",h,", Median:",p,", Q3:",u,", Max:",l].join("");S.append("g").attr("id","barchart-stats-g").append("text").attr("x",0).attr("y",g/2).text(_);var T=S.append("g").attr("id","barchart-g").attr("transform","translate(0,"+g+")scale(1)");T.append("g").attr("id","barchart-axis-y").attr("transform","translate(0,"+b+")scale(1)").call(v),T.append("g").attr("id","h-axis-label-g").attr("transform","translate("+j/2+","+b+")scale(1)").append("text").attr("id","h-axis-label").attr("text-anchor","middle").attr("x",0).attr("y",35).style("font-size","8pt").text((function(){return a&&"All samples"===a?"Pairwise SNP-distance (All samples)":"Pairwise SNP-distance ("+a+": "+n+")"})),T.append("g").attr("id","barchart-axis-x").attr("transform","translate(-5,0)scale(1) ").call(y),T.append("g").attr("id","v-axis-label-g").attr("transform","translate(-5,"+b/2+")scale(1) rotate(-90)").append("text").attr("id","v-axis-label").attr("text-anchor","middle").attr("x",0).attr("y",-35).style("font-size","8pt").text("Count"),T.append("g").attr("id","bar-group").selectAll(".barchart-bar").data(f).enter().append("rect").attr("class","barchart-bar").attr("stroke","white").attr("stroke-width","0.5px").attr("fill","gray").attr("x",(function(e){return O(e[0])})).attr("y",(function(e){return x(e[1])})).attr("width",(function(e){return m})).attr("height",(function(e){return Math.abs(x(e[1])-x(0))}))}a(21);var En=Object(f.b)((function(e){return{snpDistSettings:e.snpDistSettings,hammingMatrix:e.hammMatrix,metadata:e.metadata}}),(function(e){return Object(m.b)({dist_changeIsUserDraw:cn,dist_changeIsUserExport:on,dist_changeChartSession:ln,dist_changeIsUserLoadSession:dn,isShowingLoadingModalToStore:da},e)}))((function(e){var t=Object(r.useRef)(),a=Object(r.useRef)(),s=100*Math.max(document.documentElement.clientWidth,window.innerWidth||0)/100-200-20,i=Je(100)-120-20,c={top:20,right:20,bottom:40,left:60},o=s-c.left-c.right,l=i-c.top-c.bottom,d=Object(r.useState)(!1),u=Object(It.a)(d,2),p=u[0],j=u[1],b=e.metadata?Array.from(e.metadata.values()):null,f=e.snpDistSettings.dataToDisplay,m=e.snpDistSettings.dataColumn,x=e.snpDistSettings.dataColumnLevel,O=e.snpDistSettings.snpDistExportFormat,y=e.snpDistSettings.isUserDrawChart,v=e.snpDistSettings.isUserExportSnpDist,S=e.snpDistSettings.chartSession,_=e.snpDistSettings.isUserReloadSession;S&&setTimeout((function(){T(),j(!0)}),10),Object(r.useEffect)((function(){y&&(e.isShowingLoadingModalToStore(!0),setTimeout((function(){!function(){gn.a("#snpdist_svgGroup").remove();var t=[],n=[];e.hammingMatrix.forEach((function(e,a){n.push(a),t=t.concat(e)}));var r=new ba(n,t).getSymetricEdges().edges;if("all"===f){var s=r.map((function(e){return e.value}));Tn("All samples",null,gn.a(a.current),s,o,l,c,e.dist_changeChartSession)}else{var i=null;if("INTRA-Group"===x||"INTER-Group"===x){var d=[null,"NA","N/A","#N/A","#NA","",!1,"false","nil","null",void 0],u=new Map;b.forEach((function(e){-1===d.indexOf(e[m])&&u.set(e.sample_id,e[m])})),i="INTRA-Group"===x?r.filter((function(e){return u.get(e.source)===u.get(e.target)})):r.filter((function(e){return u.get(e.source)!==u.get(e.target)}))}else{var p=(j=m,O=x,b.filter((function(e){return e[j]===O})).map((function(e){return e.sample_id})));i=r.filter((function(e){return-1!==p.indexOf(e.source)&&-1!==p.indexOf(e.target)}))}var h=i?i.map((function(e){return e.value})):[],g=gn.a(a.current);Tn(m,x,g,h,o,l,c,e.dist_changeChartSession)}var j,O}(),j(!0),e.dist_changeIsUserDraw(!1),e.isShowingLoadingModalToStore(!1)}),10))}),[y]),Object(r.useEffect)((function(){_&&setTimeout((function(){T(),j(!0),e.dist_changeIsUserLoadSession(!1)}),10)}),[_]),Object(r.useEffect)((function(){if(v)switch(O){case"symSnpDist":var t=[],a=[];e.hammingMatrix.forEach((function(e,n){a.push(n),t=t.concat(e)})),!function(e){e&&new ca.ExportToCsv({fieldSeparator:",",filename:"GraphSNP_symetric_pairwise_snp_differences",quoteStrings:'"',decimalSeparator:".",showLabels:!0,showTitle:!1,useTextFile:!1,useBom:!0,useKeysAsHeaders:!0}).generateCsv(e)}(new ba(a,t).getSymetricEdges().edges),e.dist_changeIsUserExport(!1);break;case"barChartSvg":!function(e){var t=document.querySelector("#".concat(e)),a=new XMLSerializer;"summary-piechart"===e&&(t=document.querySelector("#".concat(e," svg")));var n=a.serializeToString(t);Ze("GraphSNP-".concat(e,".svg"),n)}("snpdist-chart-svg")}}),[O,v]);function T(){gn.a("#snpdist_svgGroup").remove(),wn(gn.a(a.current),S)}return Object(n.jsxs)(h.a,{children:[Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)("div",{id:"snpdist-cont-is-empty",style:{display:"block"},children:Object(n.jsx)(Ct.a,{style:{display:p?"none":"block"},description:S?"Reload previous chart":"No chart, create one ",image:Ct.a.PRESENTED_IMAGE_SIMPLE})})}),Object(n.jsx)(g.a,{ref:t,sm:24,children:Object(n.jsx)("div",{id:"snpdist-chart-container",style:{height:"100%",width:"100%"},children:Object(n.jsx)("svg",{id:"snpdist-chart-svg",ref:a})})})]})})),Dn=Dt.a.Sider,Cn=Dt.a.Content;var In=Object(f.b)((function(e){return{hammingMatrix:e.hammMatrix}}),(function(e){return Object(m.b)({},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(Dt.a,{children:[Object(n.jsx)(Dn,{id:"snpdist-sider",children:Object(n.jsx)(hn,{})}),Object(n.jsxs)(Dt.a,{id:"snpdist-container",children:[e.hammingMatrix&&Object(n.jsx)(Cn,{children:Object(n.jsx)(En,{})}),!e.hammingMatrix&&Object(n.jsx)(Cn,{children:Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)("div",{id:"snpdist-cont-is-empty",style:{display:"block"},children:Object(n.jsx)(Ct.a,{description:"No input: Load one.",image:Ct.a.PRESENTED_IMAGE_SIMPLE})})})})]})]})})})),Ln=a(145),Nn=a(1397),Mn=a(73),An=Object(Mn.a)();var Un=Object(f.b)((function(e,t){return{navLocation:e.navSettings.navLocation}}),(function(e,t){return Object(m.b)({changeNavLocation:ue},e)}))((function(e){var t=e.navLocation?e.navLocation:function(e){if(!e)return"none";switch(e){case"/":return"home";case"/graphsnp":return"graphsnp";case"/documentation":return"documentation";case"/snpdistance":return"matrix";default:return"none"}}(An.location.pathname);return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(Ln.a,{id:"header-menu",mode:"horizontal",selectedKeys:[t],overflowedIndicator:Object(n.jsx)(Nn.a,{}),children:[Object(n.jsx)(Ln.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ba.b,{to:"/",exact:!0,children:"Input"})},"home"),Object(n.jsx)(Ln.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ba.b,{to:"/snpdistance",children:"SNP-distances"})},"snpdistance"),Object(n.jsx)(Ln.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ba.b,{to:"/graphsnp",children:"Graph"})},"graphsnp"),Object(n.jsx)(Ln.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ba.b,{to:"/documentation",children:"Documentation"})},"documentation")]})})})),kn=a.p+"static/media/logo.1375c904.png",Rn=(a(1350),function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(h.a,{id:"main-header",children:[Object(n.jsx)(g.a,{id:"header-navigation",xs:8,sm:18,children:Object(n.jsx)(Un,{})}),Object(n.jsx)(g.a,{id:"header-logo",xs:16,sm:6,children:Object(n.jsx)("img",{style:{float:"right"},src:kn,alt:"GraphSNP",height:"75px"})})]})})}),Fn=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=Object(n.jsxs)(p.d,{children:[Object(n.jsx)(p.b,{exact:!0,path:"/",component:Et}),Object(n.jsx)(p.b,{path:"/graphsnp",component:za}),Object(n.jsx)(p.b,{path:"/documentation",component:en}),Object(n.jsx)(p.b,{path:"/snpdistance",component:In}),Object(n.jsx)(p.a,{to:"/"})]});return Object(n.jsxs)(p.c,{history:An,children:[Object(n.jsx)(Rn,{}),Object(n.jsx)("main",{children:e})]})}}]),a}(r.Component),Pn=function(e,t){switch(t.type){case T:return t.payload;default:return e||er.sequence}},Gn=function(e,t){switch(t.type){case _:var a=Object.assign({},e);return t.payload&&t.payload!==e.navLocation&&(a.navLocation=t.payload),a;default:return e||er.navSettings}},qn=function(e,t){switch(t.type){case N:var a=Object.assign({},e);return t.payload&&t.payload!==e.method&&(a.method=t.payload),a;case M:var n=Object.assign({},e);return t.payload&&t.payload!==e.layout&&(n.layout=t.payload),n;case A:var r=Object.assign({},e);return t.payload!==e.isUserReDraw&&(r.isUserReDraw=t.payload),r;case U:var s=Object.assign({},e);return t.payload&&t.payload!==e.edgeFilterCutoff&&(s.edgeFilterCutoff=t.payload),s;case k:var i=Object.assign({},e);return t.payload!==e.isUserFilteringEdge&&(i.isUserFilteringEdge=t.payload),i;case R:var c=Object.assign({},e);return t.payload&&t.payload!==e.clusterMethod&&(c.clusterMethod=t.payload),c;case F:var o=Object.assign({},e);return t.payload!==e.isUserClustering&&(o.isUserClustering=t.payload),o;case P:var l=Object.assign({},e);return t.payload!==e.isEdgeScaled&&(l.isEdgeScaled=t.payload),l;case G:var d=Object.assign({},e);return t.payload!==e.edgeScaleFactor&&(d.edgeScaleFactor=t.payload),d;case q:var u=Object.assign({},e);return t.payload!==e.isHideEdgesByCutoff&&(u.isHideEdgesByCutoff=t.payload),u;case z:var p=Object.assign({},e);return t.payload!==e.hiddenEdgesCutoff&&(p.hiddenEdgesCutoff=t.payload),p;case H:var h=Object.assign({},e);return t.payload&&t.payload!==e.colorNodedBy&&(h.colorNodedBy=t.payload),h;case B:var g=Object.assign({},e);return t.payload&&t.payload!==e.exportFormat&&(g.exportFormat=t.payload),g;case V:var j=Object.assign({},e);return t.payload!==e.isUserDownloading&&(j.isUserDownloading=t.payload),j;case Y:var b=Object.assign({},e);return t.payload&&t.payload!==e.transIncludeLocLevel&&(b.transIncludeLocLevel=t.payload),b;case W:var f=Object.assign({},e);return t.payload&&t.payload!==e.typeOfAnalysis&&(f.typeOfAnalysis=t.payload),f;case X:var m=Object.assign({},e);return t.payload!==e.chartSession&&(m.chartSession=t.payload),m;case $:var x=Object.assign({},e);return t.payload!==e.isUserReloadSession&&(x.isUserReloadSession=t.payload),x;case J:var O=Object.assign({},e);return t.payload!==e.isUserRelayout&&(O.isUserRelayout=t.payload),O;default:return e||er.graphSettings}},zn=function(e,t){switch(t.type){case w:return t.payload;default:return e||er.metadata}},Hn=function(e,t){switch(t.type){case D:return t.payload;default:return e||er.patientMovement}},Bn=function(e,t){switch(t.type){case x:return t.payload;default:return e||er.isInputLoading}},Vn=function(e,t){switch(t.type){case y:return t.payload;default:return e||er.graphObject}},Yn=function(e,t){switch(t.type){case v:return t.payload;default:return e||er.graphClusters}},Wn=function(e,t){switch(t.type){case S:return t.payload;default:return e||er.hammMatrix}},Xn=function(e,t){switch(t.type){case E:return t.payload;default:return e||er.categoricalMap}},$n=function(e,t){switch(t.type){case C:return t.payload;default:return e||er.colorLUT}},Jn=function(e,t){switch(t.type){case K:var a=Object.assign({},e);return t.payload&&t.payload!==e.dataToDisplay&&(a.dataToDisplay=t.payload),a;case Q:var n=Object.assign({},e);return t.payload&&t.payload!==e.dataColumn&&(n.dataColumn=t.payload),n;case Z:var r=Object.assign({},e);return t.payload&&t.payload!==e.dataColumnLevel&&(r.dataColumnLevel=t.payload),r;case ee:var s=Object.assign({},e);return t.payload!==e.chartOrientation&&(s.chartOrientation=t.payload),s;case te:var i=Object.assign({},e);return t.payload!==e.chartType&&(i.chartType=t.payload),i;case ne:var c=Object.assign({},e);return t.payload&&t.payload!==e.snpDistExportFormat&&(c.snpDistExportFormat=t.payload),c;case re:var o=Object.assign({},e);return t.payload!==e.isUserDrawChart&&(o.isUserDrawChart=t.payload),o;case ae:var l=Object.assign({},e);return t.payload!==e.isUserGenerateMatrix&&(l.isUserGenerateMatrix=t.payload),l;case se:var d=Object.assign({},e);return t.payload!==e.isUserExportSnpDist&&(d.isUserExportSnpDist=t.payload),d;case ie:var u=Object.assign({},e);return t.payload!==e.chartSession&&(u.chartSession=t.payload),u;case ce:var p=Object.assign({},e);return t.payload!==e.isUserReloadSession&&(p.isUserReloadSession=t.payload),p;default:return e||er.snpDistSettings}},Kn=function(e,t){switch(t.type){case I:return t.payload;default:return e||er.selectDemoData}},Qn=function(e,t){switch(t.type){case L:return t.payload;default:return e||er.selectedNode}},Zn=function(e,t){switch(t.type){case O:return t.payload;default:return e||er.isShowingLoadingModal}},er={sequence:null,metadata:null,patientMovement:null,selectDemoData:null,categoricalMap:null,isInputLoading:!1,hammMatrix:null,graphObject:null,graphClusters:null,selectedNode:null,graphSettings:{typeOfAnalysis:"clustering",method:"cathai",layout:"cose",isUserReDraw:!1,isUserFilteringEdge:!0,edgeFilterCutoff:25,clusterMethod:"Connected Components",isUserClustering:!1,isEdgeScaled:!1,edgeScaleFactor:1,isHideEdgesByCutoff:!1,hiddenEdgesCutoff:{min:0,max:25},colorNodedBy:"na",exportFormat:"clusterID",isUserDownloading:!1,transIncludeLocLevel:1,chartSession:null,isUserReloadSession:!1,isUserRelayout:!1},snpDistSettings:{dataToDisplay:"all",dataColumn:null,dataColumnLevel:null,chartType:"barplot",isUserGenerateMatrix:!1,chartOrientation:"horizontal",isUserDrawChart:!1,snpDistExportFormat:"symSnpDist",isUserExportSnpDist:!1,chartSession:null,isUserReloadSession:!1},navSettings:{navLocation:null},colorLUT:null,isShowingLoadingModal:!1},tr=Object(m.c)({sequence:Pn,metadata:zn,selectDemoData:Kn,categoricalMap:Xn,patientMovement:Hn,navSettings:Gn,graphSettings:qn,hammMatrix:Wn,graphObject:Vn,graphClusters:Yn,isInputLoading:Bn,colorLUT:$n,snpDistSettings:Jn,selectedNode:Qn,isShowingLoadingModal:Zn},er),ar=a(565),nr=a.n(ar),rr=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,1398)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),r(e),s(e),i(e)}))},sr=function(){return Object(m.a)(nr.a)(m.d)(tr,er,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())}();c.a.render(Object(n.jsx)(f.a,{store:sr,children:Object(n.jsx)(Fn,{})}),document.getElementById("root")),rr()},249:function(e,t,a){},358:function(e,t,a){},530:function(e,t,a){},584:function(e,t,a){},585:function(e,t,a){},676:function(e,t){},678:function(e,t){}},[[1353,1,2]]]);