(this["webpackJsonpgraph-snp"]=this["webpackJsonpgraph-snp"]||[]).push([[0],{1047:function(e,t,a){},1350:function(e,t,a){},1353:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(0),s=a.n(r),i=a(33),c=a.n(i),o=(a(584),a(192)),l=a(193),d=a(194),u=a(203),p=(a(585),a(48)),h=a(1387),g=a(1386),b=a(1378),j=a(548),f=(a(271),a(37)),m=a(31),x="INPUT_LOADING",O="GRAPH_OBJECT",y="GRAPH_CLUSTER",v="MATRIX_HAMMING",S="NAV_LOCATION",_="SEQ_DATA",T="META_DATA",w="METADATA_CATEGORICAL",E="TIME_TREE_DATA",D="COLOR_LUT",C="SELECT_DEMO_DATA",I="SELECTED_NODE",N="SETTING_METHOD",L="SETTING_LAYOUT",M="SETTING_IS_USER_REDRAW",A="SETTING_EDGE_FILTER_CUTOFF",k="SETTING_IS_USER_FILTER_EDGES",U="SETTING_CLUSTER_METHOD",F="SETTING_IS_USER_CLUSTERING",P="SETTING_IS_EDGE_SCALED",R="SETTING_EDGE_SCALE_FACTOR",q="SETTING_IS_HIDE_EDGES",G="SETTING_EDGE_HIDE_CUTOFF",H="SETTING_COLOR_NODE_BY",z="SETTING_EXPORT_FORMAT",B="SETTING_IS_USER_DOWNLOADING",V="SETTING_TRANS_LOC_LEVEL",W="SETTING_TYPE_ANALYSIS",Y="SETTING_CHART_SESSION",X="SETTING_IS_USER_LOAD_SESSION",$="DIST_DATA_TO_DISPLAY",J="DIST_DATA_COLUMN",Q="DIST_DATA_COLUMN_LEVEL",K="DIST_CHART_ORIENTATION",Z="DIST_CHART_TYPE",ee="DIST_IS_USER_GENERATE_MATRIX",te="DIST_EXPORT_FORMAT",ae="DIST_IS_USER_DRAW",ne="DIST_IS_USER_EXPORT",re="DIST_CHART_SESSION",se="DIST_IS_USER_LOAD_SESSION",ie={demo1:{snps:"./data/demoFile/1/st78_snps_input.fa",metadata:"./data/demoFile/1/st78_metadata_input.csv",stayTimeline:"./data/demoFile/1/st78_patientStayTimeline_input.csv"},demo2:{snps:"./data/demoFile/2/seqtk_snps_input.fa",metadata:"./data/demoFile/2/seqtk_metadata_input.csv",stayTimeline:null}},ce="./data/templateFile/snps_input.fa",oe="./data/templateFile/metadata_input.csv",le="./data/templateFile/patientStayTimeline_input.csv";function de(e){return{type:S,payload:e}}var ue=a(1394),pe=a(1374),he=a(573),ge=a(66),be=a(109),je=a(1390),fe=a(1391),me=a(1392),xe=a(1393);function Oe(e){return{type:_,payload:e}}function ye(e){return{type:T,payload:e}}function ve(e){return{type:E,payload:e}}function Se(e){return{type:x,payload:e}}function _e(e){return{type:C,payload:e}}function Te(e){return{type:v,payload:e}}function we(e){return{type:O,payload:e}}function Ee(e){return{type:y,payload:e}}var De=a(53),Ce=a.n(De),Ie=a(175),Ne=a(1383),Le=a(1376),Me=a(91),Ae=a.n(Me),ke=a(96),Ue=a(1382),Fe=a(532),Pe=a(1389),Re=a(1366),qe=a(1365),Ge=a(1388),He=Object(ke.extendMoment)(Ae.a),ze=a(21);function Be(e,t,a){return a.indexOf(e)===t}function Ve(e,t){var a=ze.cloneDeep(e),n=null;if(Array.isArray(a)&&a.length>0){"clusterID"===t&&(a=a.filter((function(e){return"na"!==e.clusterID})));var r=[],s=[];a.forEach((function(e){r.push(e[t]),"sample_date"===t&&s.push(e.sample_date)}));var i=r.filter(Be),c=s.length>0?qe.a(s):null,o=Object(Fe.a)(Re.a).domain(i),l=c?function(e){var t=He(e[0]),a=He(e[1]),n=t.isoWeek().toString(),r=a.isoWeek().toString(),s=t.isoWeekYear().toString(),i=a.isoWeekYear().toString(),c=parseInt(s+n),o=parseInt(i+r);return Object(Ue.a)(Pe.a).domain([c,o])}(c):null,d=new Map;a.forEach((function(e){if("sample_date"===t){var a=He(e[t]),n=a.isoWeek().toString(),r=a.isoWeekYear().toString(),s=parseInt(r+n),i=Object(Ge.a)(l(s)).formatHex();d.set(e.sample,i)}else d.set(e.sample,o(e[t]))})),n=d}return n}function We(e,t){var a=ze.cloneDeep(t),n=new Map;return a.forEach((function(t){var a=t[e]&&Object(Ge.a)(t[e])?Object(Ge.a)(t[e]).formatHex():Object(Ge.a)("lightgray").formatHex();n.set(t.sample_id,a)})),n}function Ye(e,t,a,n){if(e){var r=t+1,s=r?r*a:3;return"edge"===n||s<1?s:1}return"edge"===n?3:1}function Xe(e){return e*Math.max(document.documentElement.clientHeight,window.innerHeight||0)/100}function $e(e){var t=0;return e.hospital_id&&(t=1,e.ward_id&&(t=2,e.bay_id&&(t=3,e.bed_id&&(t=4)))),t}function Je(e,t){var a=0;return e.hospital_id===t.hospital_id&&(a=1,e.ward_id===t.ward_id&&(a=2,e.bay_id===t.bay_id&&(a=3,e.bed_id===t.bed_id&&(a=4)))),a}function Qe(e,t){var a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}var Ke=a(590);function Ze(e){this.seq=e,this.seqIDs=e.map((function(e){return e.id}))}Ze.prototype.getHammingMatrix=function(){for(var e=this.seq,t=this.seqIDs,a=new Map,n=0;n<t.length-1;n++)for(var r=e[n],s=n+1;s<e.length;s++){var i=e[s],c=Ke(r.sequence,i.sequence);if(a.get(r.id)){var o=a.get(r.id);o.push({source:r.id,target:i.id,value:c,part:"upper"}),a.set(r.id,o)}else{var l=[{source:r.id,target:i.id,value:c,part:"upper"}];a.set(r.id,l)}if(a.get(i.id)){var d=a.get(i.id);d.push({source:i.id,target:r.id,value:c,part:"lower"}),a.set(i.id,d)}else{var u=[{source:i.id,target:r.id,value:c,part:"lower"}];a.set(i.id,u)}}return a};var et=Ze,tt=a(21),at=Object(ke.extendMoment)(Ae.a),nt=a(591).fastaToJson,rt=Object(Le.a)("%Y-%m-%d");function st(e,t,a,n){return it.apply(this,arguments)}function it(){return(it=Object(Ie.a)(Ce.a.mark((function e(t,a,n,r){var s,i,c,o,l,d,u,p,h;return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(t);case 2:if(s=e.sent,i=[],!(Array.isArray(s)&&s.length>1)){e.next=40;break}c={},o=[],l=!0,d=0;case 9:if(!(d<s.length)){e.next=37;break}if(u=s[d].messages,p=s[d].parsedSequence,h=s[d].success,-1===o.indexOf(p.size)&&o.push(p.size),h){e.next=18;break}return l=!1,alert("Parsing error:",p.name),e.abrupt("break",37);case 18:if(!(u.length>0)){e.next=22;break}return l=!1,alert(u[0]),e.abrupt("break",37);case 22:if(!(o.length>1)){e.next=26;break}return l=!1,alert("Size error: Alignment required sequence with same length"),e.abrupt("break",37);case 26:if(c[p.name]){e.next=30;break}c[p.name]=!0,e.next=33;break;case 30:return l=!1,alert("Sequence error: Duplicated sequence"),e.abrupt("break",37);case 33:l&&i.push({id:p.name,size:p.size,sequence:p.sequence.toLowerCase()});case 34:d++,e.next=9;break;case 37:l&&(he.b.success("The sequences have been loaded, now building distance matrix ..",1),setTimeout((function(){var e=new et(i).getHammingMatrix();he.b.success("Pair-wise SNP distance matrix has been created",1),a(i),n(e),r(!1)}),100)),e.next=41;break;case 40:alert("Error: Required at least 2 sequences");case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e,t,a,n,r){return ot.apply(this,arguments)}function ot(){return(ot=Object(Ie.a)(Ce.a.mark((function e(t,a,n,r,s){var i,c,o,l,d,u,p,h,g,b,j,f,m;return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ne.a)(t).then((function(e){return e}));case 2:if(i=e.sent,c=["sample_id","sample_date","patient_id"],o=Object.keys(i[0]),l=!0,c.forEach((function(e){-1===o.indexOf(e)&&(l=!1)})),l){e.next=11;break}return alert("Invalid headers: One or more required headers was not found"),s(!1),e.abrupt("return");case 11:if(d=tt.countBy(i,"sample_id"),!((u=Object.keys(d).map((function(e){return{name:e,count:d[e]}})).filter((function(e){return e.count>1}))).length>0)){e.next=17;break}return alert("Invalid data: duplicate record in column sample id"+"".concat(JSON.stringify(u))),s(!1),e.abrupt("return");case 17:if(!!!d[""]){e.next=22;break}return alert("Invalid data: column sample_id contain empty record"),s(!1),e.abrupt("return");case 22:if(p=!1,i.forEach((function(e){e.sample_id=e.sample_id.replace(/\s*$/,""),e.sample_date=e.sample_date.replace(/\s*$/,""),rt(e.sample_date)?(e.uid=e.sample_id,e.sample_date=rt(e.sample_date)):p=!0})),!p){e.next=28;break}return alert("Invalid data: wrong date format in column sample date"),s(!1),e.abrupt("return");case 28:h=[],g=[],o.forEach((function(e){var t=e.split(":");t.length>1&&"color"===t[1]?g.push(t[0]):"sample_id"!==e&&h.push(e)})),b={},j=new Map,f=["0",0,"null","na","#N/A","NA","","excluded"],h.forEach((function(e){var t=e,a=[],n=[];i.forEach((function(e){var r={};r.sample=e.sample_id,r[t]=e[t],n.push(r),a.push(e[t])})),a.filter(Be),a.forEach((function(e){var a=n.filter((function(a){return a[t]===e})).map((function(e){return e.sample}));if(-1===f.indexOf(e)){var r=t.concat("-",e);j.set(r,a)}}));var r=null;g.indexOf(e)>-1?r=We(e.concat(":color"),i):r=Ve(n,t);b[t]=r})),m=new Map,i.forEach((function(e){m.set(e.sample_id,e)})),a(m),n(b),r(j),s(!1);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e,t,a){return dt.apply(this,arguments)}function dt(){return(dt=Object(Ie.a)(Ce.a.mark((function e(t,a,n){var r,s,i,c,o,l,d;return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ne.a)(t).then((function(e){return e}));case 2:if(r=e.sent,s=["patient_id","start_date","end_date","hospital_id","ward_id","bay_id","bed_id"],i=["null",""," ","na","NA","N/A","#N/A","NULL","Null"],c=Object.keys(r[0]),o=!0,s.forEach((function(e){-1===c.indexOf(e)&&(o=!1)})),o){e.next=12;break}return alert("Invalid headers: One or more required headers was not found"),n(!1),e.abrupt("return");case 12:if(l=!1,r.forEach((function(e){e.patient_id=e.patient_id.replace(/\s*$/,""),e.start_date=e.start_date.replace(/\s*$/,""),e.end_date=e.end_date.replace(/\s*$/,""),e.hospital_id=-1!==i.indexOf(e.hospital_id)?null:e.hospital_id.replace(/\s*$/,""),e.ward_id=-1!==i.indexOf(e.ward_id)?null:e.ward_id.replace(/\s*$/,""),e.bay_id=-1!==i.indexOf(e.bay_id)?null:e.bay_id.replace(/\s*$/,""),e.bed_id=-1!==i.indexOf(e.bed_id)?null:e.bed_id.replace(/\s*$/,""),at(e.start_date)&&at(e.end_date)?(e.start_date=at(e.start_date),e.end_date=at(e.end_date)):l=!0})),!l){e.next=18;break}return alert("Invalid data: wrong date format in column start_date and or end_date"),n(!1),e.abrupt("return");case 18:d=new Map,r.map((function(e){return e.patient_id})).filter(Be).forEach((function(e){var t=[];r.filter((function(t){return t.patient_id===e})).forEach((function(a){var n={pid:e,start_date:a.start_date,end_date:a.end_date,hospital_id:a.hospital_id,ward_id:a.ward_id,bay_id:a.bay_id,bed_id:a.bed_id};t.push(n)})),d.set(e,t)})),a(d),n(!1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ut=pe.a.Dragger;var pt=Object(f.b)((function(e){return{sequence:e.sequence,patientMovement:e.patientMovement}}),(function(e){return Object(m.b)({sequenceToStore:Oe,isinputLoadingToStore:Se,hmmMatrixToStore:Te},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{children:[Object(n.jsx)(ut,{accept:".fa, .fasta, .fna, .mfa",showUploadList:!1,style:{backgroundColor:"transparent",height:"500px"},name:"file",multiple:!1,action:"dummy-post",beforeUpload:function(t){if(t){var a=new FileReader;a.readAsText(t),e.isinputLoadingToStore(!0),a.onloadend=function(t){console.log(t),st(t.target.result,e.sequenceToStore,e.hmmMatrixToStore,e.isinputLoadingToStore)}}return!1},children:Object(n.jsx)("div",{id:"input-loader-snps",children:Object(n.jsxs)(ge.a,{id:"input-loader-button-snps",shape:"round",size:"large",children:[e.sequence?Object(n.jsx)(je.a,{style:{fontSize:"14pt"}}):Object(n.jsx)(fe.a,{})," SNPs ","  ",Object(n.jsx)("span",{style:{marginLeft:"5px"},children:Object(n.jsx)(be.a,{title:"Input or drag and drop non-ambiguous multi-fasta SNPs alignment file here",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{fontSize:"14px",color:"white"}})})})]})})}),Object(n.jsx)("div",{className:"remove-button-container",children:Object(n.jsx)(ge.a,{disabled:!e.sequence,title:"Remove loaded SNPs alignment",type:"ghost",className:"input-loader-remove-button ",shape:"circle",size:"small",onClick:function(t){e.sequenceToStore(null),e.hmmMatrixToStore(null)},children:Object(n.jsx)(xe.a,{})})})]})})}));function ht(e){return{type:D,payload:e}}function gt(e){return{type:w,payload:e}}var bt=pe.a.Dragger;var jt=Object(f.b)((function(e){return{metadata:e.metadata}}),(function(e){return Object(m.b)({metadataToStore:ye,colorLUTtoStore:ht,isinputLoadingToStore:Se,categoricalMapToStore:gt},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{children:[Object(n.jsx)(bt,{accept:".csv",showUploadList:!1,style:{height:"500px",backgroundColor:"transparent"},name:"file",multiple:!1,action:"dummy-post",beforeUpload:function(t){if(t){var a=new FileReader;a.readAsDataURL(t),e.isinputLoadingToStore(!0),a.onloadend=function(t){ct(t.target.result,e.metadataToStore,e.colorLUTtoStore,e.categoricalMapToStore,e.isinputLoadingToStore)}}return!1},children:Object(n.jsx)("div",{id:"input-loader-metadata",children:Object(n.jsxs)(ge.a,{id:"input-loader-button-metadata",shape:"round",size:"large",children:[e.metadata?Object(n.jsx)(je.a,{style:{fontSize:"14pt"}}):Object(n.jsx)(fe.a,{})," Metadata"," ",Object(n.jsx)("span",{style:{marginLeft:"5px"},children:Object(n.jsx)(be.a,{title:"Input or drag and drop metadata file (CSV) here",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{fontSize:"14px",color:"white"}})})})]})})}),Object(n.jsx)("div",{className:"remove-button-container",children:Object(n.jsx)(ge.a,{disabled:!e.metadata,title:"Remove loaded metadata",type:"ghost",className:"input-loader-remove-button ",shape:"circle",size:"small",onClick:function(t){e.metadataToStore(null),e.colorLUTtoStore(null),e.categoricalMapToStore(null)},children:Object(n.jsx)(xe.a,{})})})]})})})),ft=pe.a.Dragger;var mt=Object(f.b)((function(e){return{patientMovement:e.patientMovement}}),(function(e){return Object(m.b)({patientMovementToStore:ve,isinputLoadingToStore:Se},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{children:[Object(n.jsx)(ft,{accept:".csv",showUploadList:!1,style:{height:"500px",backgroundColor:"transparent"},name:"file",multiple:!1,action:"dummy-post",beforeUpload:function(t){if(t){var a=new FileReader;a.readAsDataURL(t),e.isinputLoadingToStore(!0),a.onloadend=function(t){lt(t.target.result,e.patientMovementToStore,e.isinputLoadingToStore)}}return!1},children:Object(n.jsx)("div",{id:"input-loader-patientMovement",children:Object(n.jsxs)(ge.a,{id:"input-loader-button-patientMovement",shape:"round",size:"large",children:[e.patientMovement?Object(n.jsx)(je.a,{twoToneColor:"#52c41a"}):Object(n.jsx)(fe.a,{})," Patient stay timeline"," ",Object(n.jsx)("span",{style:{marginLeft:"5px"},children:Object(n.jsx)(be.a,{title:"Input or drag and drop patient stay timeline (CSV) here",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{fontSize:"14px",color:"white"}})})})]})})}),Object(n.jsx)("div",{className:"remove-button-container",children:Object(n.jsx)(ge.a,{disabled:!e.patientMovement,title:"Remove loaded timeline",type:"ghost",className:"input-loader-remove-button ",shape:"circle",size:"small",onClick:function(t){e.patientMovementToStore(null)},children:Object(n.jsx)(xe.a,{})})})]})})})),xt=a(202),Ot=xt.a.Option;var yt=Object(f.b)((function(e){return{selectDemoData:e.selectDemoData}}),(function(e){return Object(m.b)({selectDemoDataToStore:_e,sequenceToStore:Oe,metadataToStore:ye,patientMovementToStore:ve,isinputLoadingToStore:Se,hmmMatrixToStore:Te,colorLUTtoStore:ht,categoricalMapToStore:gt},e)}))((function(e){var t=e.selectDemoData;function a(){return(a=Object(Ie.a)(Ce.a.mark((function e(t,a,n,r,s){var i,c,o;return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return i=e.sent,r(!0),e.next=6,i.blob();case 6:c=e.sent,(o=new FileReader).readAsText(c),o.onloadend=function(e){var t=e.target.result;s(t,a,n,r)};case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsx)(g.a,{xs:24,children:Object(n.jsxs)(xt.a,{value:t,onChange:function(t){if(t){var n=ie[t];e.sequenceToStore(null),e.hmmMatrixToStore(null),e.metadataToStore(null),e.colorLUTtoStore(null),e.categoricalMapToStore(null),e.patientMovementToStore(null),n.snps&&function(e,t,n,r,s){a.apply(this,arguments)}(n.snps,e.sequenceToStore,e.hmmMatrixToStore,e.isinputLoadingToStore,st),n.metadata&&ct(n.metadata,e.metadataToStore,e.colorLUTtoStore,e.categoricalMapToStore,e.isinputLoadingToStore),n.stayTimeline&&lt(n.stayTimeline,e.patientMovementToStore,e.isinputLoadingToStore),e.selectDemoDataToStore(t)}else e.selectDemoDataToStore(null)},children:[Object(n.jsx)(Ot,{value:null,children:"Select sample data"}),Object(n.jsx)(Ot,{value:"demo1",children:"VRE ST78 outbreak"}),Object(n.jsx)(Ot,{value:"demo2",children:"SeqTrack demonstration"})]})})})})),vt=function(e){return Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{sm:24,id:"footer-component",children:Object(n.jsxs)("p",{children:[Object(n.jsx)("a",{href:"https://graphsnp.beatsonlab.com",target:"_blank",rel:"noopener noreferrer",children:Object(n.jsx)("b",{children:"GraphSNP v.1 (beta) "})}),Object(n.jsx)("br",{}),Object(n.jsxs)("b",{children:[" ","Graph-based outbreak cluster and transmission",Object(n.jsx)("br",{})," detection and visualization using single-nucleotide polymorphisms (SNPs) in web browser"]}),Object(n.jsx)("br",{})," Developed by Budi Permana at"," ",Object(n.jsxs)("a",{href:"https://beatsonlab.com/",target:"_blank",rel:"noopener noreferrer",children:[" ","Beatson Lab"]}),Object(n.jsx)("br",{})," ",Object(n.jsx)("a",{href:"https://www.uq.edu.au/",target:"_blank",rel:"noopener noreferrer",children:"The University of Queensland"})," ","| Australia"]})})})},St=a(546),_t=a.n(St),Tt=Object(n.jsx)(ue.a,{style:{fontSize:34},spin:!0}),wt=String(Xe(100)-380)+"px",Et={fpsLimit:24,particles:{number:{value:25},size:{value:4},links:{enable:!0,distance:75},move:{enable:!0,speed:2,outModes:{default:"bounce"}}},interactivity:{events:{onhover:{enable:!1,mode:"repulse"}}}};var Dt=Object(f.b)((function(e){return{isInputLoading:e.isInputLoading}}),(function(e){return Object(m.b)({changeNavLocation:de},e)}))((function(e){return Object(n.jsxs)(s.a.Fragment,{children:[Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{xs:24,id:"header-content",children:Object(n.jsx)(b.a,{visible:e.isInputLoading,closable:!1,centered:!0,width:0,footer:null,bodyStyle:{textAlign:"center",padding:"0px"},children:Object(n.jsx)(j.a,{indicator:Tt,style:{color:"white"},tip:"Processing...",size:"large"})})})}),Object(n.jsxs)(h.a,{id:"input-wrapper",children:[Object(n.jsx)(_t.a,{params:Et,height:wt,style:{position:"absolute",height:"200px"}}),Object(n.jsx)(g.a,{xs:24,sm:8,children:Object(n.jsx)(pt,{})}),Object(n.jsx)(g.a,{xs:24,sm:8,children:Object(n.jsx)(jt,{})}),Object(n.jsx)(g.a,{xs:24,sm:8,children:Object(n.jsx)(mt,{})})]}),Object(n.jsx)(h.a,{id:"demo-selection",children:Object(n.jsx)(yt,{})}),Object(n.jsx)(vt,{})]})})),Ct=a(1368),It=(a(1047),a(58)),Nt=a(1380),Lt=a(1372),Mt=a(1395);function At(e){return{type:N,payload:e}}function kt(e){return{type:L,payload:e}}function Ut(e){return{type:M,payload:e}}function Ft(e){return{type:A,payload:e}}function Pt(e){return{type:k,payload:e}}function Rt(e){return{type:U,payload:e}}function qt(e){return{type:F,payload:e}}function Gt(e){return{type:P,payload:e}}function Ht(e){return{type:R,payload:e}}function zt(e){return{type:q,payload:e}}function Bt(e){return{type:G,payload:e}}function Vt(e){return{type:H,payload:e}}function Wt(e){return{type:z,payload:e}}function Yt(e){return{type:B,payload:e}}function Xt(e){return{type:V,payload:e}}function $t(e){return{type:W,payload:e}}function Jt(e){return{type:Y,payload:e}}function Qt(e){return{type:X,payload:e}}function Kt(e){return{type:I,payload:e}}var Zt=Nt.a.Panel,ea=Object(ke.extendMoment)(Ae.a);var ta=Object(f.b)((function(e){return{metadata:e.metadata,colorLUT:e.colorLUT,selectedNode:e.selectedNode,graphObject:e.graphObject}}),(function(e){return Object(m.b)({changeSelectedNode:Kt},e)}))((function(e){var t=Object(r.useState)({columns:null,cells:null}),a=Object(It.a)(t,2),i=a[0],c=a[1];return Object(r.useEffect)((function(){if(e.selectedNode)if(e.selectedNode.length>0){var t=e.selectedNode.map((function(t){return e.metadata.get(t)})),a=[],n=[];t.forEach((function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var s=Object(It.a)(r[t],2),i=s[0],c=s[1];a.push({title:i,dataIndex:i,key:i+(0).toString()});var o=n[0],l={};o&&(l=Object.assign({},o)),l.key||(l.key=(0).toString()),l[i]="sample_date"===i?ea(c).format("YYYY-MM-DD"):c,n=[l]}})),c({columns:a,cells:n})}else c({columns:null,cells:null})}),[e.selectedNode]),Object(n.jsx)(s.a.Fragment,{children:Object(n.jsx)("div",{style:{position:"absolute",zIndex:"10",top:"inherit",width:"100%"},children:e.metadata&&Object(n.jsx)(h.a,{children:Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(Nt.a,{bordered:!1,expandIconPosition:"left",children:Object(n.jsxs)(Zt,{style:{marginBottom:"0px",textAlign:"left",overflowY:"auto"},header:Object(n.jsxs)("p",{style:{marginBottom:"0px"},children:[Object(n.jsx)(Mt.a,{})," Selected node metadata"]}),children:[e.selectedNode&&e.graphObject&&i.columns&&Object(n.jsx)(Lt.a,{size:"small",pagination:!1,style:{width:"100%"},dataSource:i.cells,columns:i.columns}),!e.selectedNode&&Object(n.jsx)("p",{children:"No selected node"})]},"100")})})})})})})),aa=a(204),na=a(1384),ra=a(1367),sa=a(350),ia=a(494).Graph,ca=a(1160);var oa=xt.a.Option;var la=Object(f.b)((function(e){return{metadata:e.metadata,patientMovement:e.patientMovement,sequence:e.sequence,graphSettings:e.graphSettings,graphObject:e.graphObject,graphClusters:e.graphClusters,colorLUT:e.colorLUT}}),(function(e){return Object(m.b)({changeMethodSetting:At,changeLayoutSetting:kt,changeIsUserReDrawSetting:Ut,changeEdgeFilterCutoffSetting:Ft,changeClusterMethodSetting:Rt,changeIsUserClusteringSetting:qt,changeIsEdgeScaledSetting:Gt,changeEdgeScaleFactorSetting:Ht,changeColorNodeSetting:Vt,changeExportFormatSetting:Wt,changeIsUserDownloadingSetting:Yt,changeIsHideEdgesByCutoff:zt,changeEdgesHideCutoff:Bt,changeTransIcludeLocLevel:Xt,changeTypeOfAnalysisSetting:$t,changeIsUserFilterEdgesSetting:Pt},e)}))((function(e){var t=e.graphSettings.method,a=e.graphSettings.layout,r=e.graphSettings.isUserReDraw,i=e.graphSettings.isUserFilteringEdge,c=e.graphSettings.edgeFilterCutoff,o=e.graphSettings.clusterMethod,l=e.graphSettings.isUserClustering,d=e.graphSettings.isEdgeScaled,u=e.graphSettings.edgeScaleFactor,p=e.graphSettings.isHideEdgesByCutoff,b=e.graphSettings.hiddenEdgesCutoff,j=e.graphSettings.colorNodedBy,f=e.graphSettings.exportFormat,m=e.graphSettings.transIncludeLocLevel,x=e.graphSettings.typeOfAnalysis,O=function(t){e.changeMethodSetting(t)},y=function(e,t){return Object(n.jsx)(oa,{disabled:!1,value:e,children:e},t)};return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(h.a,{gutter:[8,8],children:[Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Graph settings"}),Object(n.jsxs)("p",{children:["Type of analysis"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Analysis to be performed. [1]Clustering: construct an undirected graph and detect putative cluster(s). [2]Transmission: construct a directed graph to show the putative transmission flow",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:!e.sequence,value:x,style:{width:"100%"},onChange:function(t){"clustering"===t?e.changeMethodSetting("cathai"):e.changeMethodSetting("seqtrack"),e.changeTypeOfAnalysisSetting(t)},children:[Object(n.jsxs)(oa,{disabled:!e.sequence,value:"clustering",children:[" ","Clustering"," "]}),Object(n.jsx)(oa,{disabled:!e.sequence||!e.metadata,value:"transmission",children:"Transmission"})]})]}),"clustering"===x&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Method"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Method to construct clustering graph.  [1]CATHAI: draw all pairwise SNP distances between nodes (cases) (Forde et al. 2021).  [2]Minimum CATHAI: Like CATHAI but only include the lowest pairwise SNP distance(s) as the representation of each node  [3]Weighted minimum CATHAI: Like minimum CATHAI but weighted with other categorical information from the metadata",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:!e.sequence||!x,value:t,style:{width:"100%"},onChange:O,children:[Object(n.jsx)(oa,{value:"cathai",children:"CATHAI"}),Object(n.jsx)(oa,{value:"mcg",children:"Minimum CATHAI"}),Object(n.jsx)(oa,{disabled:!e.sequence||!e.metadata,value:"cge",children:"Weighted minimum CATHAI"})]})]}),"transmission"===x&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Method"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Method to construct transmission graph.  [1]SeqTrack: construct a parsimonous transmission tree based on SNP distances and sampling dates (Jombart et al. 2014).  [2]SNPs and patient stay: construct a directed graph where edges were weighted by sum of SNPs distance weight and patient stays",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:!x,value:t,style:{width:"100%"},onChange:O,children:[Object(n.jsx)(oa,{value:"seqtrack",children:"SeqTrack"}),Object(n.jsx)(oa,{value:"hierSnpsMetaStayOverlap",children:"SNPs and patient stay"})]})]}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Layout"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Layout to display the graph.",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:!e.sequence,value:a,style:{width:"100%"},onChange:function(t){e.changeLayoutSetting(t)},children:[Object(n.jsx)(oa,{value:"cose",children:" CoSE"}),Object(n.jsx)(oa,{value:"spread",children:"Spread"}),Object(n.jsx)(oa,{value:"fcose",children:"fCoSE"})]})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsxs)(aa.a,{style:{fontSize:"10px"},onChange:function(t){var a=t.target.checked;e.changeIsUserFilterEdgesSetting(a)},checked:i,disabled:!e.sequence||"clustering"!==x,children:["Apply SNPs cutoff"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Apply a cutoff number to limit the maximum pairwise SNPs distance to be displayed.",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]})}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Cutoff number"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Maximum pairwise SNPs distance to be included in graph  (e.g. 25 SNPs cutoff will include edges with 0 to 25 SNPs).",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsx)(na.a,{min:0,disabled:!i||!e.sequence||"clustering"!==x,step:1,value:c,onChange:function(t){t>0&&e.changeEdgeFilterCutoffSetting(t)},style:{marginBottom:"5px"}})]}),"hierSnpsMetaStayOverlap"===t&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Filter weighted edges",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Filter edges based on its weight.  The weight is a combination score computed from pairwise SNP distances and stay overlap in hierarhical order. The weight assignation are:  #1 (all SNP distances),  #2 (#1+SNP distances less and equal to cutoff), #3 (#2+They had overlap stay at hospital level), #4 (#3+They had overlap stay at ward level), #5 (#4+They had overlap stay at bay level), and #6 (#5+They had overlap stay at bed level). So an edge with weight of #6 represents the highest score for a possible transmission based on their SNPs distance and stay overlap in bed level. *Stay overlap is considered in 7 days range (REF)",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:"hierSnpsMetaStayOverlap"!==t,value:m,style:{width:"100%"},onChange:function(t){e.changeTransIcludeLocLevel(t)},children:[Object(n.jsx)(oa,{value:1,children:"SNPs"}),Object(n.jsx)(oa,{value:2,children:"Hospital"}),Object(n.jsx)(oa,{value:3,children:"Ward"}),Object(n.jsx)(oa,{value:4,children:"Bay"}),Object(n.jsx)(oa,{value:5,children:"Bed"})]})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(ge.a,{disabled:!e.sequence,onClick:function(){r||e.changeIsUserReDrawSetting(!0)},type:"primary",children:"Create graph"})}),"clustering"===x&&e.graphObject&&Object(n.jsx)(ra.a,{style:{margin:"10px 0px 0px 0px"}}),"clustering"===x&&e.graphObject&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Clustering settings"}),Object(n.jsxs)("p",{children:["Method"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Method to detect cluster in the constructed graph. [1]Connected components: using Breadth-first search algorithm (Zhou and Hansen,2006) to find cluster (all connected nodes) [2]Louvain: using Louvain algoritm (Subelj and Bajec, 2011) to find the cluster(s) ",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:!e.graphObject,value:o,style:{width:"100%"},onChange:function(t){e.changeClusterMethodSetting(t)},children:[Object(n.jsx)(oa,{value:"Connected Components",children:"Connected Components"}),Object(n.jsx)(oa,{value:"Louvain",children:"Louvain"})]})]}),"clustering"===x&&e.graphObject&&Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(ge.a,{type:"primary",disabled:!e.graphObject,onClick:function(){l||e.changeIsUserClusteringSetting(!0)},children:"Detect clusters"})}),Object(n.jsx)(ra.a,{style:{margin:"10px 0px 0px 0px"}}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Visualization settings"}),Object(n.jsxs)(aa.a,{style:{fontSize:"10px"},onChange:function(t){var a=t.target.checked;e.changeIsEdgeScaledSetting(a)},checked:d,disabled:!e.graphObject,children:["Scale edge to its weight"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Change the thickness of the edge accordin to its weight. (e.g. the higher the transmission score the thicker the line).",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]})]}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Scaling factor"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Multiply the thickness of the edge with the scaling factor (positive number greater than zero)",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsx)(na.a,{min:1e-5,disabled:!d||!e.graphObject,step:.1,value:u,onChange:function(t){t>0&&e.changeEdgeScaleFactorSetting(t)}})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsxs)(aa.a,{style:{fontSize:"10px"},onChange:function(t){var a=t.target.checked;e.changeIsHideEdgesByCutoff(a)},checked:p,disabled:!e.graphObject,children:["Hide edges"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Hide edges which have weight within the specified range (min to max) (Note: It doesn't remove the edges but only hide it to the background)",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]})}),Object(n.jsxs)(g.a,{span:12,children:[Object(n.jsx)("p",{children:"Minimum"}),Object(n.jsx)(na.a,{min:0,disabled:!p||!e.graphObject,step:.1,value:b.min,onChange:function(t){if(t>=0){var a={min:t,max:b.max};e.changeEdgesHideCutoff(a)}}})]}),Object(n.jsxs)(g.a,{span:12,children:[Object(n.jsx)("p",{children:"Maximum"}),Object(n.jsx)(na.a,{min:0,disabled:!p||!e.graphObject,step:.1,value:b.max,onChange:function(t){if(t>0){var a={min:b.min,max:t};e.changeEdgesHideCutoff(a)}}})]}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Node color"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Color nodes by the selected column in metadata or by the clustering result. User can also specify the color manually (e.g. To specify color on column 'patient_group', add new column named 'patient_group:color' in metadata).",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:!e.graphObject,value:j,style:{width:"100%"},onChange:function(t){e.changeColorNodeSetting(t)},children:[" ",e.colorLUT&&Object.keys(e.colorLUT)?Object.keys(e.colorLUT).map((function(e,t){return y(e,t)})):["na"].map((function(e,t){return y(e,t)}))]})]}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Download settings"}),Object(n.jsxs)("p",{children:["Type"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Type of file to be downloaded:  [1]Graph image (SVG) [2]Graph object file (DOT format: suitable for visualization with HAIviz) [3]Clustering result (CSV).",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{value:f,style:{width:"100%"},onChange:function(t){e.changeExportFormatSetting(t)},disabled:!e.graphObject&&!e.graphClusters,children:[Object(n.jsx)(oa,{disabled:!e.graphObject,value:"svg",children:"Graph image (SVG)"}),Object(n.jsx)(oa,{disabled:!e.graphObject,value:"dot",children:"Graph file (DOT)"}),Object(n.jsx)(oa,{disabled:!e.graphClusters,value:"clusterID",children:"Clustering result (CSV)"})]})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(ge.a,{disabled:!e.graphClusters&&!e.graphObject,onClick:function(){switch(f){case"clusterID":(t=e.graphClusters.members)&&new sa.ExportToCsv({fieldSeparator:",",filename:"GraphSNP_clusterID",quoteStrings:'"',decimalSeparator:".",showLabels:!0,showTitle:!1,useTextFile:!1,useBom:!0,useKeysAsHeaders:!0}).generateCsv(t);break;case"svg":e.changeIsUserDownloadingSetting(!0);break;case"dot":!function(e){var t=-1!==["hierSnpsMetaStayOverlap"].indexOf(e.creator),a=e.nodes,n=e.edges,r=new ia({multigraph:!0});Array.isArray(a)&&a.length>0&&a.forEach((function(e){r.setNode(e)})),Array.isArray(n)&&n.length>0&&n.forEach((function(e){var a=e.source,n=e.target,s=e.value?e.value:"null";console.log(s);var i=t?"forward":"none";r.setEdge(a,n,{weight:s,dir:i})})),Qe("Graph_in_DOT.gv",ca.write(r))}(e.graphObject)}var t},type:"primary",children:"Download"})})]})})})),da=a(356),ua=a(111);function pa(e,t){this.nodes=e,this.edges=t}pa.prototype.getSymetricEdges=function(){var e=this.edges;return e=e.filter((function(e){return"upper"===e.part})),new pa(this.nodes,e)},pa.prototype.getEdgesLowerThanCutoff=function(e){var t=this.edges;return e&&e>0&&(t=t.filter((function(t){return t.value<e}))),new pa(this.nodes,t)},pa.prototype.getEdgesGreaterThanCutoff=function(e){var t=this.edges;return e&&e>0&&(t=t.filter((function(t){return t.value>e}))),new pa(this.nodes,t)};var ha=pa,ga=a(21);var ba=a(21);var ja=a(21);function fa(e){this.stays=e}fa.prototype.getRangeOfStays=function(){var e,t;return Array.isArray(this.stays)&&this.stays.length>0&&this.stays.forEach((function(a){e=e?e>a.start_date?a.start_date:e:a.start_date,t=t?t<a.end_date?a.end_date:t:a.end_date})),{start_date:e,end_date:t}},fa.prototype.getLocationLevel=function(){var e;return Array.isArray(this.stays)&&this.stays.length>0&&this.stays.forEach((function(t){var a=$e(t);e?a>e&&(e=a):e=a})),e};var ma=fa,xa=Object(ke.extendMoment)(Ae.a),Oa=a(21);function ya(e,t,a,n,r){for(var s=0,i=a.stays.filter((function(e){return $e(e)===r})),c=n.stays.filter((function(e){return $e(e)===r})),o=0;o<i.length;o++)for(var l=i[o],d=xa.range(l.start_date.startOf("day"),l.end_date.endOf("day")),u=0;u<c.length;u++){var p=c[u],h=xa.range(p.start_date.startOf("day"),p.end_date.endOf("day"));if(d.overlaps(h))if(d.intersect(h).diff("days")<=7){var g=Je(l,p);g>s&&(s=g)}}return s}var va=a(21),Sa=Object(ke.extendMoment)(Ae.a),_a=a(1167);function Ta(e,t,a,n,r,s,i,c){var o={creator:null,nodes:null,edges:null};switch(t){case"mcg":var l=function(e,t){var a=ga.cloneDeep(e),n=[],r=[];a.forEach((function(e,a){r.push(a);for(var s=e.sort((function(e,t){return e.value-t.value})),i=s[0].value,c=0,o=0;o<s.length;o++){if(s[o].value!==i){c=o;break}c=o}s.splice(c),null!==t&&t>0&&(s=s.filter((function(e){return e.value<=t}))),n=n.concat(s)}));var s=new ha(r,n).getSymetricEdges();return{nodes:s.nodes,edges:s.edges}}(e,a);o.creator="mcg",o.nodes=l.nodes,o.edges=l.edges;break;case"cathai":var d=function(e,t){var a=ba.cloneDeep(e),n=[],r=[];a.forEach((function(e,a){r.push(a);var s=e;null!==t&&t>0&&(s=s.filter((function(e){return e.value<=t}))),n=n.concat(s)}));var s=new ha(r,n).getSymetricEdges();return{nodes:s.nodes,edges:s.edges}}(e,a);o.creator="cathai",o.nodes=d.nodes,o.edges=d.edges;break;case"cge":var u=function(e,t,a){var n=ja.cloneDeep(e),r=[],s=[];n.forEach((function(e,t){s.push(t);for(var a=e.sort((function(e,t){return e.value-t.value})),n=a[0].value,i=0,c=0;c<a.length;c++){if(a[c].value!==n){i=c;break}i=c}a.splice(i),r=r.concat(a)}));var i=new ha(s,r).getSymetricEdges(),c=i.edges;return c.forEach((function(e){e.value=1,null!==a&&e.value<=a&&(e.value=e.value+1),t.forEach((function(t,a){-1!==t.indexOf(e.source)&&-1!==t.indexOf(e.target)&&(e.value=e.value+1)}))})),{nodes:i.nodes,edges:c}}(e,n,a);o.creator="cge",o.nodes=u.nodes,o.edges=u.edges;break;case"seqtrack":var p=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=va.cloneDeep(e),s=[];t.forEach((function(e,t){s.push({id:t,date:e.sample_date})}));for(var i=!1,c=0;c<s.length;c++){var o=s[c];if(!r.has(o.id)){i=!0,alert("Case id in metadata is not consistent with taxa id in alignment:"+o.id);break}}function l(e,r){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;if(r.length>1){var o=r.map((function(e){return e.date=Sa(c.get(e.id).sample_date),e})).sort((function(e,t){return e.date>t.date}));if(n&&s){console.log("with mutation");var l=Sa(e.date),d=o.map((function(e){var t=l.diff(e.date,"days"),a=_a(e.snpDist,t*s,i);return e.dayDiff=t,e.probability=a,e})).sort((function(e,t){return e.probability<t.probability}))[0];return{ances:d.id,snpDist:d.snpDist}}var u=o[0];return{ances:u.id,snpDist:u.snpDist}}}function d(e,t,a){for(var n=[],r=0;r<t.length;r++){var s=t[r].id,i=a.get(s).filter((function(t){return t.target===e.id}));n.push({id:s,snpDist:i[0].value})}return n.sort((function(e,t){return e.snpDist-t.snpDist})),n.filter((function(e){return e.snpDist===n[0].snpDist}))}function u(e,t,a){var n={ances:null,snpDist:null},r=t.filter((function(t){return t.date<e.date}));if(0===r.length)return n.ances="NA",n.snpDist="NA",n;if(1===r.length){n.ances=r[0].id;var s=a.get(r[0].id).filter((function(t){return t.target===e.id}));return n.snpDist=s[0].value,n}var i=d(e,r,a);if(i.length>1){var c=l(e,i);return n.ances=c.ances,n.snpDist=c.snpDist,n}return n.ances=i[0].id,n.snpDist=i[0].snpDist,n}if(i){return{nodes:null,edges:null}}for(var p=new Map,h=0;h<s.length;h++){var g=s[h],b=u(g,s,r);p.set(g.id,b)}var j={nodes:[],edges:[]};return p.forEach((function(e,t){j.nodes.push(t),"NA"!==e.ances&&j.edges.push({source:e.ances,target:t,value:e.snpDist,dir:"forward"})})),j}(e,s,c);o.creator="seqtrack",o.nodes=p.nodes,o.edges=p.edges;break;case"hierSnpsMetaStayOverlap":var h=function(e,t,a,n,r){var s=Oa.cloneDeep(e),i=Oa.cloneDeep(a),c=[],o=[];s.forEach((function(e,a){o.push(a);var n=e;null!==t&&t>0&&(n=n.filter((function(e){return e.value<=t}))),c=c.concat(n)}));var l=[],d=[];if(c.length>0)for(var u=0;u<c.length;u++){var p=c[u],h=n.get(p.source).patient_id,g=n.get(p.target).patient_id,b=xa(n.get(p.source).sample_date),j=xa(n.get(p.target).sample_date),f=i.get(h)?new ma(i.get(h)):null,m=i.get(g)?new ma(i.get(g)):null;if(f instanceof ma&&m instanceof ma&&Array.isArray(f.stays)&&Array.isArray(m.stays)&&f.stays.length>0&&m.stays.length>0){var x=f.getLocationLevel(),O=m.getLocationLevel(),y=Math.min(x,O)?Math.min(x,O):null;if(y){var v=f.getRangeOfStays(),S=m.getRangeOfStays(),_=xa.range(v.start_date.startOf("day"),v.end_date.endOf("day")),T=xa.range(S.start_date.startOf("day"),S.end_date.endOf("day"));if(_.overlaps(T))if(j.isAfter(b,"day")){var w=ya(0,0,f,m,y);p.dir="forward",p.value=1+w,l.push(p)}else p.dir="none",p.value=1,d.push(p);else p.dir="none",p.value=1,d.push(p)}else p.dir="none",p.value=1,d.push(p)}else p.dir="none",p.value=1,d.push(p)}return l=l.filter((function(e){return e.value>=r})),{nodes:o,edges:l}}(e,a,r,s,i);o.creator="hierSnpsMetaStayOverlap",o.nodes=h.nodes,o.edges=h.edges}return o}function wa(e,t,a){var n,r,s,i,c=[],o=[];for(c.push(e),a[e]=!0;c.length>0;)for(e=c.shift(),o.push(e),n=0,r=(s=t[e]).length;n<r;n+=1)a[i=s[n]]||(c.push(i),a[i]=!0);return o}var Ea=a(1333);function Da(e,t){var a=null;switch(t){case"Connected Components":a=function(e){var t,a=e.nodes,n=function(e){var t,a,n,r,s,i={};for(t=0,a=e.length;t<a;t+=1)r=(n=e[t]).source,s=n.target,i[r]?i[r].push(s):i[r]=[s],i[s]?i[s].push(r):i[s]=[r];return i}(e.edges),r=[],s={};for(t in n)n.hasOwnProperty(t)&&!s[t]&&r.push(wa(t,n,s));var i=[];r=r.sort((function(e,t){return t.length-e.length}));var c=[];return r.forEach((function(e,t){Array.isArray(e)&&e.length>0&&e.forEach((function(e){c.push(e),i.push({sample:e,clusterID:t+1})}))})),a.forEach((function(e){-1===c.indexOf(e)&&i.push({sample:e,clusterID:"na"})})),console.log(i),{group:r,members:i}}(e);break;case"Louvain":a=function(e){var t=e.edges,a=e.nodes,n=[];t.forEach((function(e){n.push(e.source,e.target)})),n=n.filter(Be);var r=new Map,s=[],i=Ea.jLouvain().nodes(n).edges(t)(),c=[];for(var o in i){c.push(o);var l=i[o]+1;if(s.push({sample:o,clusterID:l}),r.get(l)){var d=r.get(l);d.push(o),r.set(l,d)}else r.set(l,[o])}var u=[];return r.forEach((function(e,t){u.push(e)})),a.forEach((function(e){-1===c.indexOf(e)&&s.push({sample:e,clusterID:"na"})})),{group:u,members:s}}(e)}return a}var Ca=a(177),Ia=a.n(Ca),Na=a(560),La=a.n(Na),Ma=a(1396),Aa=a(21),ka=a(1337),Ua=a(1340);Ia.a.use(ka),Ia.a.use(Ua),Ia.a.use(La.a);var Fa=Object(f.b)((function(e){return{metadata:e.metadata,patientMovement:e.patientMovement,sequence:e.sequence,graphObject:e.graphObject,hammMatrix:e.hammMatrix,graphSettings:e.graphSettings,colorLUT:e.colorLUT,graphClusters:e.graphClusters,categoricalMap:e.categoricalMap}}),(function(e){return Object(m.b)({changeIsUserClusteringSetting:qt,changeIsUserReDrawSetting:Ut,hmmMatrixToStore:Te,graphObjectToStore:we,graphClusterToStore:Ee,colorLUTtoStore:ht,changeIsUserDownloadingSetting:Yt,changeChartSessionSetting:Jt,changeIsUserLoadSessionSetting:Qt,changeSelectedNode:Kt},e)}))((function(e){var t=Object(r.useState)(!1),a=Object(It.a)(t,2),i=a[0],c=a[1],o=Object(r.useState)(!1),l=Object(It.a)(o,2),d=l[0],u=l[1],p=(e.graphSettings.typeOfAnalysis,e.graphSettings.method),h=e.graphSettings.layout,b=e.graphSettings.isUserReDraw,j=e.graphSettings.isUserFilteringEdge?e.graphSettings.edgeFilterCutoff:null,f=e.graphSettings.clusterMethod,m=e.graphSettings.isUserClustering,x=e.graphSettings.isHideEdgesByCutoff,O=e.graphSettings.hiddenEdgesCutoff,y=e.graphSettings.colorNodedBy,v=e.graphSettings.isEdgeScaled,S=e.graphSettings.edgeScaleFactor,_=e.graphSettings.isUserDownloading,T=e.graphSettings.transIncludeLocLevel,w={name:h,animate:!1,fit:!0},E=Object(r.useRef)(null),D=e.graphSettings.chartSession,C=e.graphSettings.isUserReloadSession;Object(r.useEffect)((function(){b&&(u(!0),setTimeout((function(){!function(){var t=e.hammMatrix?e.hammMatrix:new et(e.sequence).getHammingMatrix(),a=e.sequence?e.sequence[0].size:null,n=Ta(t,p,j,e.categoricalMap,e.patientMovement,e.metadata,T,a);if(n&&n.nodes&&n.edges){var r=function(e){var t=e.creator,a=e.nodes,n=e.edges,r=[];return n.forEach((function(e){r.push({data:{source:e.source,target:e.target,weight:e.value,dir:"forward"===e.dir?"forward":"none"}})})),a.forEach((function(e){var a="nlv"===t?e.data:[],n="nlv"===t?"compound":"singleton";r.push({data:{id:e,nodeType:n,data:a}})})),r}(n);if(r){var s=Ia()({elements:r,container:document.getElementById("graph-cont-cytoscape-canvas"),pannable:!0,selected:!0,boxSelectionEnabled:!1,style:[{selector:"node",style:{label:"data(id)","border-width":3,"border-style":"solid","border-color":"black","background-color":"lightgray"}},{selector:"edge",style:{opacity:function(e){var t=e.data("weight");return x&&(t<O.min||t>O.max)?0:1},label:"data(weight)","font-size":"10px","text-background-color":"#F5E372",color:"red",width:function(e){return Ye(v,e.data("weight"),S,"edge")},"target-arrow-color":"black","target-arrow-shape":function(e){return"forward"===e.data("dir")?"triangle":"none"},"curve-style":"bezier","arrow-scale":function(e){return Ye(v,e.data("weight"),S,"arrow")}}},{selector:":selected",style:{"border-width":"5","border-color":"red","border-style":"dashed",padding:"8px"}}]});if("spread"===h){var i={name:"cose",animate:!1,fit:!0,prelayout:!1};s.layout(i).run()}else s.layout(w).run();s.selectionType("single"),s.nodes().bind("tap",(function(t){var a=[t.target.data("id")];e.changeSelectedNode(a)})),s.on("tap",(function(t){t.target===s&&e.changeSelectedNode([])})),E.current=s,e.hammMatrix&&e.hmmMatrixToStore(t),e.graphObjectToStore(n),e.changeChartSessionSetting(r)}}}(),c(!0),u(!1),e.changeIsUserReDrawSetting(!1)}),10))}),[b]),Object(r.useEffect)((function(){C&&(u(!0),setTimeout((function(){!function(){var t=D;if(t){var a=Ia()({elements:t,container:document.getElementById("graph-cont-cytoscape-canvas"),pannable:!0,selected:!0,boxSelectionEnabled:!1,style:[{selector:"node",style:{label:"data(id)","border-width":3,"border-style":"solid","border-color":"black","background-color":"lightgray"}},{selector:"edge",style:{opacity:function(e){var t=e.data("weight");return x&&(t<O.min||t>O.max)?0:1},label:"data(weight)","font-size":"10px","text-background-color":"#F5E372",color:"red",width:function(e){return Ye(v,e.data("weight"),S,"edge")},"target-arrow-color":"black","target-arrow-shape":function(e){return"forward"===e.data("dir")?"triangle":"none"},"curve-style":"bezier","arrow-scale":function(e){return Ye(v,e.data("weight"),S,"arrow")}}},{selector:":selected",style:{"border-width":"5","border-color":"red","border-style":"dashed",padding:"8px"}}]});if("spread"===h){var n={name:"cose",animate:!1,fit:!0,prelayout:!1};a.layout(n).run()}else a.layout(w).run();a.selectionType("single"),a.nodes().bind("tap",(function(t){var a=[t.target.data("id")];e.changeSelectedNode(a)})),a.on("tap",(function(t){t.target===a&&e.changeSelectedNode([])})),E.current=a}}(),c(!0),u(!1),e.changeIsUserLoadSessionSetting(!1)}),10))}),[C]),Object(r.useEffect)((function(){_&&(Qe("GraphSNP-cytoscape-svg.svg",E.current.svg({scale:1,full:!0})),e.changeIsUserDownloadingSetting(!1))}),[_]),Object(r.useEffect)((function(){m&&e.graphObject&&(u(!0),setTimeout((function(){var t=Da(e.graphObject,f);u(!1),he.b.success("Found ".concat(t.group.length," clusters in the graph"),2);var a=Ve(t.members,"clusterID"),n=Aa.cloneDeep(e.colorLUT);n?n=Object(da.a)(Object(da.a)({},n),{},{clusterID:a}):n={clusterID:a};e.colorLUTtoStore(n),e.graphClusterToStore(t),e.changeIsUserClusteringSetting(!1)}),100))}),[f,m]),Object(r.useEffect)((function(){if(h&&E.current){var e=E.current,t={name:h,animate:!1,fit:!0,prelayout:!1};e.layout(t).run(),E.current=e}}),[h]),Object(r.useEffect)((function(){if(e.graphObject&&E.current){var t=E.current;v?(t.style().selector("edge").style({width:function(e){return Ye(v,e.data("weight"),S,"edge")},"arrow-scale":function(e){return Ye(v,e.data("weight"),S,"arrow")}}).update(),E.current=t):(t.style().selector("edge").style({width:3,"arrow-scale":1}).update(),E.current=t)}}),[v,S]),Object(r.useEffect)((function(){if(e.graphObject&&E.current){var t=E.current;x?(t.style().selector("edge").style({opacity:function(e){var t=e.data("weight");return x&&(t<O.min||t>O.max)?0:1}}).update(),E.current=t):(t.style().selector("edge").style({opacity:1}).update(),E.current=t),E.current=t}}),[x,O]),Object(r.useEffect)((function(){if(y&&e.colorLUT&&E.current){var t=E.current;t.style().selector("node").style({"background-color":function(t){return function(e,t,a){var n="lightgray";if("na"!==t){var r=a[t];n=r.get(e)?r.get(e):"lightgray"}return n}(t.data("id"),y,e.colorLUT)}}).update(),E.current=t}}),[y,e.colorLUT]);return Object(n.jsxs)(s.a.Fragment,{children:[Object(n.jsxs)(g.a,{span:24,style:{position:"relative"},children:[Object(n.jsx)("div",{id:"graph-cont-is-empty",style:{display:i?"none":"block"},children:Object(n.jsx)(ua.a,{description:D?"Reload previous graph":"No graph. Create one",image:ua.a.PRESENTED_IMAGE_SIMPLE,children:D&&Object(n.jsx)(ge.a,{onClick:function(t){C||e.changeIsUserLoadSessionSetting(!0)},type:"primary",children:Object(n.jsx)(Ma.a,{})})})}),Object(n.jsx)("div",{id:"graph-cont-is-processing",style:{display:d?"block":"none"},children:Object(n.jsxs)("p",{style:{textAlign:"right"},children:[Object(n.jsx)("span",{children:Object(n.jsx)(ue.a,{style:{fontSize:18},spin:!0})})," ","Creating graph ..."]})})]}),Object(n.jsx)("div",{id:"graph-cont-cytoscape-canvas"})]})})),Pa=Ct.a.Sider,Ra=Ct.a.Content,qa=function(){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(Ct.a,{children:[Object(n.jsx)(Pa,{id:"graphsnp-sider",children:Object(n.jsx)(la,{})}),Object(n.jsx)(Ct.a,{children:Object(n.jsxs)(Ra,{id:"graphsnp-container",children:[Object(n.jsx)(ta,{}),Object(n.jsx)(Fa,{})]})})]})})},Ga=a(1375),Ha=a(126),za=(a(249),Ga.a.Title),Ba=Ga.a.Text,Va=function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{className:"graphsnp-docs-content",children:[Object(n.jsxs)(za,{level:2,underline:!0,children:[" ","GraphSNP: What is it?"," "]}),Object(n.jsx)(Ba,{children:"GraphSNP is a web-based application to create and visualise network of pairwise SNP distances for outbreak cluster and transmission analysis. It is a client-side and standalone version of integrated cluster analysis platform CATHAI: Cluster Analysis for Healthcare Associated Infection (REF:Forde et al., 2021)"}),Object(n.jsx)(za,{level:3,children:"When to use "}),Object(n.jsx)(Ba,{children:"You can use GraphSNP for:"}),Object(n.jsxs)("ul",{children:[Object(n.jsxs)("li",{children:["Rapid outbreak network visualization:"," ",Object(n.jsx)("b",{children:"No instalation required, drag and drop input files, interactive and easy to use."})]}),Object(n.jsxs)("li",{children:[" ",Object(n.jsx)("b",{children:"Visualize distribution "})," of pairwise SNP distances from a multi-fasta SNPs aligment"," "]}),Object(n.jsxs)("li",{children:[" ",Object(n.jsx)("b",{children:"Create network "}),"of pairwise SNP distances and"," ",Object(n.jsx)("b",{children:"apply SNPs cutoff "}),"for cluster analysis"]}),Object(n.jsxs)("li",{children:[Object(n.jsx)("b",{children:"Automatic cluster detection "})," based on community detection algorithms"]}),Object(n.jsxs)("li",{children:[" ",Object(n.jsx)("b",{children:"Create transmission tree "})," based on SNPs, sampling dates, and patient stay timeline (for nosocomial outbreak)"," "]})]}),Object(n.jsx)(za,{level:3,children:"How to use "}),Object(n.jsxs)(Ba,{children:["Simple, have at least a multi-fasta SNPs alignment file as the input file then drag and drop it to",Object(n.jsxs)(Ha.a,{to:"/graphsnp",onClick:function(){e.changeNavLocation("graphsnp")},children:[" ","GraphSNP page."]})," ","You can also add other information like metadata and patient stay timeline to the analysis."]}),Object(n.jsx)(ra.a,{})]})})},Wa=Ga.a.Title,Ya=(Ga.a.Paragraph,Ga.a.Text),Xa=function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{className:"graphsnp-docs-content",children:[Object(n.jsxs)(Wa,{level:2,underline:!0,children:[" ","Input file(s)"," "]}),Object(n.jsx)(Wa,{level:3,children:"A multi-fasta SNPs alignment"}),Object(n.jsx)(Ya,{children:"SNPs alignment file must contain at least two equally length of fasta-formatted non-gap nucleotide sequences."}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(ge.a,{type:"primary",href:ce,children:"Download SNPs example file"}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(Wa,{level:3,children:"Metadata table"}),Object(n.jsx)(Ya,{children:"Metadata table must contain at least three non-empty columns: sampleID, sampleDate, and sampleSource. Sample identifier must be identical on both metadata and SNPs alignment."}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(ge.a,{type:"primary",href:oe,children:"Download metadata example file"}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(Wa,{level:3,children:"Patient stay timeline table "}),Object(n.jsx)(Ya,{children:"Patient stay timeline table (for nosocomial transmission analysis) should list the period and location of patient stay in the hospital. Such information must be provided in CSV-formatted file ."}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(ge.a,{type:"primary",href:le,children:"Download Patient stay timeline example file"}),Object(n.jsx)(ra.a,{})]})})},$a=Ga.a.Title,Ja=Ga.a.Text,Qa=function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)("div",{className:"graphsnp-docs-content",children:[Object(n.jsxs)($a,{level:2,underline:!0,children:["Browser compatibility"," "]}),"GraphSNP was boostrapped using Create React App (CRA) tool and so it works on majority of modern browsers. Except Internet Explorer (IE), GraphSNP was tested and compatible on the following desktop browsers:",Object(n.jsxs)("ul",{children:[Object(n.jsx)("li",{children:" Microsoft Edge (v.xx) "}),Object(n.jsx)("li",{children:" Safari (v.xx)"}),Object(n.jsx)("li",{children:" Chrome (v.xx) "}),Object(n.jsx)("li",{children:" Firefox (v.90.0)"}),Object(n.jsx)("li",{children:" Opera (v.xx) "})]}),Object(n.jsx)($a,{level:3,children:"Core libraries"}),Object(n.jsxs)(Ja,{children:["Thanks to all the frameworks and libraries run on the background, GraphSNP is now up and running and available worldwide. These are some of key frameworks and libraries used by GraphSNP:",Object(n.jsxs)("ul",{children:[Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://reactjs.org/",target:"_blank",rel:"noopener noreferrer",children:"React.js"})}),Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://d3js.org/",target:"_blank",rel:"noopener noreferrer",children:"Data-Driven Documents (D3.js)"})}),Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://ant.design/",target:"_blank",rel:"noopener noreferrer",children:"Ant design UI"})}),Object(n.jsx)("li",{children:Object(n.jsx)("a",{href:"https://js.cytoscape.org/",target:"_blank",rel:"noopener noreferrer",children:"Cytoscape"})}),Object(n.jsx)("li",{children:"Create React App, cytoscape-svg, dotparser, export-to-csv, lodash, moment, moment-range, react-color, react-faux-dom, react-measure, react-player, redux, react router etc."})]})]}),Object(n.jsx)($a,{level:3,children:"Have any questions? "}),Object(n.jsxs)(Ja,{children:["Please feel free to send it to my email:"," ",Object(n.jsx)("span",{style:{weight:"bold",color:"blue"},children:"b.permana@uq.edu.au"})]}),Object(n.jsxs)($a,{level:2,underline:!0,children:["Cite us"," "]}),Object(n.jsx)(Ja,{children:"If you use GraphSNP in your publication, please cite our papers [available soon] and [CATHAI paper]"}),Object(n.jsx)(ra.a,{})]})})};var Ka=Object(f.b)(null,(function(e,t){return Object(m.b)({changeNavLocation:de},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(Ct.a,{id:"page-documentation",children:[Object(n.jsx)(Va,{changeNavLocation:e.changeNavLocation}),Object(n.jsx)(Xa,{}),Object(n.jsx)(Qa,{})]})})}));a(530);function Za(e){return{type:$,payload:e}}function en(e){return{type:J,payload:e}}function tn(e){return{type:Q,payload:e}}function an(e){return{type:K,payload:e}}function nn(e){return{type:te,payload:e}}function rn(e){return{type:ae,payload:e}}function sn(e){return{type:ne,payload:e}}function cn(e){return{type:re,payload:e}}function on(e){return{type:se,payload:e}}var ln=xt.a.Option;var dn=Object(f.b)((function(e){return{snpDistSettings:e.snpDistSettings,hammingMatrix:e.hammMatrix,colorLUT:e.colorLUT,metadata:e.metadata}}),(function(e){return Object(m.b)({dist_changeDataToDisplay:Za,dist_changeDataColumn:en,dist_changeDataColumnLevel:tn,dist_changeChartOrientation:an,dist_changeExportFormat:nn,dist_changeIsUserDraw:rn,dist_changeIsUserExport:sn},e)}))((function(e){var t=e.metadata?Array.from(e.metadata.values()):null,a=e.snpDistSettings.dataToDisplay,r=e.snpDistSettings.dataColumn,i=e.snpDistSettings.dataColumnLevel,c=(e.snpDistSettings.chartOrientation,e.snpDistSettings.snpDistExportFormat),o=e.snpDistSettings.isUserDrawChart,l=e.snpDistSettings.isUserExportSnpDist;return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(h.a,{gutter:[8,8],children:[Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Bar chart settings"}),Object(n.jsxs)("p",{children:["Select isolates"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Select group of isolates for bar chart visualization.",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{value:a,style:{width:"100%"},disabled:!e.hammingMatrix,onChange:function(t){e.dist_changeDataToDisplay(t)},children:[Object(n.jsx)(ln,{value:"all",children:"All isolates"}),Object(n.jsx)(ln,{disabled:!e.metadata,value:"per-category",children:"Specific group (metadata)"})]})]}),"per-category"===a&&e.hammingMatrix&&e.metadata&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Select metadata column"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Column in metadata which group of isolates to be displayed",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsx)(xt.a,{value:r,style:{width:"100%"},disabled:"per-category"!==a||!e.hammingMatrix||!e.metadata,onChange:function(t){e.dist_changeDataColumn(t)},children:e.colorLUT&&Object.keys(e.colorLUT)?Object.keys(e.colorLUT).map((function(e,t){return function(e,t){if(-1===["sample_date","patient_id"].indexOf(e))return Object(n.jsx)(ln,{disabled:!1,value:e,children:e},t)}(e,t)})):["na"].map((function(e,t){return Object(n.jsx)(ln,{disabled:!1,value:e,children:e},t)}))})]}),"per-category"===a&&r&&e.metadata&&t&&Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsxs)("p",{children:["Select group"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Categorical group from the selected metadata column",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsx)(xt.a,{value:i,style:{width:"100%"},disabled:!("all"!==a&&r&&e.metadata&&t),onChange:function(t){e.dist_changeDataColumnLevel(t)},children:r&&t?function(e,t){if(e&&t){var a=e.map((function(e){return e[t]})).filter(Be);return Array.isArray(a)&&a.length>0?a:["#na_exluded!"]}return["#na_exluded!"]}(t,r).map((function(e,t){return function(e,t){if(-1===["#na_exluded!"].indexOf(e))return Object(n.jsx)(ln,{disabled:!1,value:e,children:e},t)}(e,t)})):["na"].map((function(e,t){return Object(n.jsx)(ln,{disabled:!1,value:e,children:e},t)}))})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(ge.a,{disabled:!e.hammingMatrix,onClick:function(t){o||e.dist_changeIsUserDraw(!0)},type:"primary",children:"Create chart"})}),Object(n.jsx)(ra.a,{style:{margin:"10px 0px 0px 0px"}}),Object(n.jsxs)(g.a,{span:24,children:[Object(n.jsx)("h5",{children:"Download settings"}),Object(n.jsxs)("p",{children:["Type"," ",Object(n.jsx)("span",{children:Object(n.jsx)(be.a,{title:"Type of file to be downloaded: Table of pairwise SNP distances (CSV) or Displayed bar chart (SVG)",placement:"rightTop",children:Object(n.jsx)(me.a,{style:{color:"red"}})})})]}),Object(n.jsxs)(xt.a,{disabled:!e.hammingMatrix,value:c,onChange:function(t){e.dist_changeExportFormat(t)},style:{width:"100%"},children:[Object(n.jsx)(ln,{disabled:!e.hammingMatrix,value:"symSnpDist",children:"Table of pairwise SNP distances (CSV)"}),Object(n.jsx)(ln,{value:"barChartSvg",children:"Bar chart (SVG)"})]})]}),Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)(ge.a,{disabled:!e.hammingMatrix,onClick:function(t){console.log("downlaod handlers"),l||e.dist_changeIsUserExport(!0)},type:"primary",children:"Download"})})]})})})),un=a(1373),pn=a(172),hn=a(1371),gn=a(353),bn=a(354),jn=a(574),fn=a(1369),mn=a(1370),xn=a(1379),On=a(1354),yn=a(1385);function vn(e,t,a,n,r,s){var i=t.length,c=parseFloat(gn.a(t)).toFixed(0),o=parseFloat(bn.a(t)).toFixed(0),l=parseFloat(jn.a(t,.25)).toFixed(1),d=parseFloat(jn.a(t,.75)).toFixed(1),u=parseFloat(fn.a(t)).toFixed(1),p=parseFloat(mn.a(t)).toFixed(1),h=a,g=n-30,b=xn.a(t,(function(e){return e.length}),(function(e){return e})),j=Array.from(b.entries()),f=Array.from(b.keys()),m=Array.from(b.values()),x=pn.a().range([g,0]),O=hn.a().range([0,h]),y=h/(On.a(0,bn.a(f)).length+1),v=x;v.domain([0,bn.a(m)]);var S=O;S.domain(On.a(0,bn.a(f)+1));var _=yn.b().scale(v),T=yn.a().scale(S).tickValues(S.domain().filter((function(e,t){return!(t%10)})));e.attr("width",a+r.left+r.right).attr("height",n+r.top+r.bottom);var w=e.append("g").attr("id","snpdist_svgGroup").attr("transform","translate("+r.left+","+r.top+")scale(1)"),E=["Pairwise distances (n:",i,"), Min: ",c,", Q1:",l,", Mean:",p,", Median:",u,", Q3:",d,", Max:",o].join("");w.append("g").attr("id","barchart-stats-g").append("text").attr("x",0).attr("y",15).text(E);var D=w.append("g").attr("id","barchart-g").attr("transform","translate(0,30)scale(1)");D.append("g").attr("id","barchart-axis-y").attr("transform","translate(0,"+g+")scale(1)").call(T).append("text").attr("class","h_axis_label").attr("text-anchor","end").attr("x",6).attr("y",6).text("income per capita, inflation-adjusted (dollars)"),D.append("g").attr("id","h-axis-label-g").attr("transform","translate("+h/2+","+g+")scale(1)").append("text").attr("id","h-axis-label").attr("text-anchor","middle").attr("x",0).attr("y",35).style("font-size","8pt").text("Pairwise SNP distance"),D.append("g").attr("id","barchart-axis-x").attr("transform","translate(-5,0)scale(1)").call(_),D.append("g").attr("id","v-axis-label-g").attr("transform","translate(-5,"+g/2+")scale(1) rotate(-90)").append("text").attr("id","v-axis-label").attr("text-anchor","middle").attr("x",0).attr("y",-35).style("font-size","8pt").text("Frequency"),D.append("g").attr("id","bar-group").selectAll(".barchart-bar").data(j).enter().append("rect").attr("class","barchart-bar").attr("stroke","white").attr("stroke-width","0.5px").attr("fill","gray").attr("x",(function(e){return S(e[0])})).attr("y",(function(e){return v(e[1])})).attr("width",(function(e){return y})).attr("height",(function(e){return Math.abs(v(e[1])-v(0))})),s({w:a,h:n,margin:r,data_len:i,data_min:c,data_max:o,data_q1:l,data_q3:d,data_median:u,data_mean:p,margin_stats:30,cont_bar_w:h,cont_bar_h:g,barMap:b,barData:j,barSNP_dist:f,barSNP_freq:m,bar_linear_scale_v:x,bar_band_scale_h:O,bar_bandWidth:y,bar_linear_scale_x:v,bar_band_scale_y:S,bar_axis_x:_,bar_axis_y:T})}a(21);var Sn=Object(f.b)((function(e){return{snpDistSettings:e.snpDistSettings,hammingMatrix:e.hammMatrix,metadata:e.metadata}}),(function(e){return Object(m.b)({dist_changeIsUserDraw:rn,dist_changeIsUserExport:sn,dist_changeChartSession:cn,dist_changeIsUserLoadSession:on},e)}))((function(e){var t=Object(r.useRef)(),a=Object(r.useRef)(),s=100*Math.max(document.documentElement.clientWidth,window.innerWidth||0)/100-200-20,i=Xe(100)-120-20,c={top:20,right:20,bottom:40,left:60},o=s-c.left-c.right,l=i-c.top-c.bottom,d=Object(r.useState)(!1),u=Object(It.a)(d,2),p=u[0],b=u[1],j=e.metadata?Array.from(e.metadata.values()):null,f=e.snpDistSettings.dataToDisplay,m=e.snpDistSettings.dataColumn,x=e.snpDistSettings.dataColumnLevel,O=(e.snpDistSettings.chartOrientation,e.snpDistSettings.snpDistExportFormat),y=e.snpDistSettings.isUserDrawChart,v=e.snpDistSettings.isUserExportSnpDist,S=e.snpDistSettings.chartSession,_=e.snpDistSettings.isUserReloadSession;S&&setTimeout((function(){T(),b(!0)}),10),Object(r.useEffect)((function(){y&&setTimeout((function(){!function(){un.a("#snpdist_svgGroup").remove();var t=[],n=[];e.hammingMatrix.forEach((function(e,a){n.push(a),t=t.concat(e)}));var r=new ha(n,t).getSymetricEdges().edges;if("all"===f){var s=r.map((function(e){return e.value}));vn(un.a(a.current),s,o,l,c,e.dist_changeChartSession)}else if(j&&m&&x){var i=(u=m,p=x,j.filter((function(e){return e[u]===p})).map((function(e){return e.sample_id}))),d=r.filter((function(e){return-1!==i.indexOf(e.source)&&-1!==i.indexOf(e.target)})).map((function(e){return e.value}));vn(un.a(a.current),d,o,l,c,e.dist_changeChartSession)}var u,p}(),b(!0),e.dist_changeIsUserDraw(!1)}),10)}),[y]),Object(r.useEffect)((function(){_&&setTimeout((function(){T(),b(!0),e.dist_changeIsUserLoadSession(!1)}),10)}),[_]),Object(r.useEffect)((function(){if(v)switch(O){case"symSnpDist":var t=[],a=[];e.hammingMatrix.forEach((function(e,n){a.push(n),t=t.concat(e)})),!function(e){e&&new sa.ExportToCsv({fieldSeparator:",",filename:"GraphSNP_symetric_pairwise_snp_differences",quoteStrings:'"',decimalSeparator:".",showLabels:!0,showTitle:!1,useTextFile:!1,useBom:!0,useKeysAsHeaders:!0}).generateCsv(e)}(new ha(a,t).getSymetricEdges().edges),e.dist_changeIsUserExport(!1);break;case"barChartSvg":!function(e){var t=document.querySelector("#".concat(e)),a=new XMLSerializer;"summary-piechart"===e&&(t=document.querySelector("#".concat(e," svg")));var n=a.serializeToString(t);Qe("GraphSNP-".concat(e,".svg"),n)}("snpdist-chart-svg")}}),[O,v]);function T(){un.a("#snpdist_svgGroup").remove(),function(e,t){var a=t.w,n=t.h,r=t.margin,s=t.data_len,i=t.data_min,c=t.data_max,o=t.data_q1,l=t.data_q3,d=t.data_median,u=t.data_mean,p=t.margin_stats,h=t.cont_bar_w,g=t.cont_bar_h,b=(t.barMap,t.barData),j=(t.barSNP_dist,t.barSNP_freq,t.bar_linear_scale_v,t.bar_band_scale_h,t.bar_bandWidth),f=t.bar_linear_scale_x,m=t.bar_band_scale_y,x=t.bar_axis_x,O=t.bar_axis_y;e.attr("width",a+r.left+r.right).attr("height",n+r.top+r.bottom);var y=e.append("g").attr("id","snpdist_svgGroup").attr("transform","translate("+r.left+","+r.top+")scale(1)"),v=["Pairwise distances (n:",s,"), Min: ",i,", Q1:",o,", Mean:",u,", Median:",d,", Q3:",l,", Max:",c].join("");y.append("g").attr("id","barchart-stats-g").append("text").attr("x",0).attr("y",p/2).text(v);var S=y.append("g").attr("id","barchart-g").attr("transform","translate(0,"+p+")scale(1)");S.append("g").attr("id","barchart-axis-y").attr("transform","translate(0,"+g+")scale(1)").call(O),S.append("g").attr("id","h-axis-label-g").attr("transform","translate("+h/2+","+g+")scale(1)").append("text").attr("id","h-axis-label").attr("text-anchor","middle").attr("x",0).attr("y",35).style("font-size","8pt").text("Pairwise SNP distance"),S.append("g").attr("id","barchart-axis-x").attr("transform","translate(-5,0)scale(1) ").call(x),S.append("g").attr("id","v-axis-label-g").attr("transform","translate(-5,"+g/2+")scale(1) rotate(-90)").append("text").attr("id","v-axis-label").attr("text-anchor","middle").attr("x",0).attr("y",-35).style("font-size","8pt").text("Frequency"),S.append("g").attr("id","bar-group").selectAll(".barchart-bar").data(b).enter().append("rect").attr("class","barchart-bar").attr("stroke","white").attr("stroke-width","0.5px").attr("fill","gray").attr("x",(function(e){return m(e[0])})).attr("y",(function(e){return f(e[1])})).attr("width",(function(e){return j})).attr("height",(function(e){return Math.abs(f(e[1])-f(0))}))}(un.a(a.current),S)}return Object(n.jsxs)(h.a,{children:[Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)("div",{id:"bar-chart-cont-is-empty",style:{display:"block"},children:Object(n.jsx)(ua.a,{style:{display:p?"none":"block"},description:S?"Reload previous chart":"No chart, create one ",image:ua.a.PRESENTED_IMAGE_SIMPLE})})}),Object(n.jsx)(g.a,{ref:t,sm:24,children:Object(n.jsx)("div",{id:"snpdist-chart-container",style:{height:"100%",width:"100%"},children:Object(n.jsx)("svg",{id:"snpdist-chart-svg",ref:a})})})]})})),_n=Ct.a.Sider,Tn=Ct.a.Content;var wn=Object(f.b)((function(e){return{hammingMatrix:e.hammMatrix}}),(function(e){return Object(m.b)({},e)}))((function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(Ct.a,{children:[Object(n.jsx)(_n,{id:"snpdist-sider",children:Object(n.jsx)(dn,{})}),Object(n.jsxs)(Ct.a,{children:[Object(n.jsx)(Tn,{children:e.hammingMatrix&&Object(n.jsx)(Sn,{})}),Object(n.jsx)(Tn,{children:!e.hammingMatrix&&Object(n.jsx)(g.a,{span:24,children:Object(n.jsx)("div",{id:"bar-chart-cont-is-empty",style:{display:"block"},children:Object(n.jsx)(ua.a,{description:"No SNPs alignment input: Please load one.",image:ua.a.PRESENTED_IMAGE_SIMPLE})})})})]})]})})})),En=a(145),Dn=a(1397),Cn=a(73),In=Object(Cn.a)();var Nn=Object(f.b)((function(e,t){return{navLocation:e.navSettings.navLocation}}),(function(e,t){return Object(m.b)({changeNavLocation:de},e)}))((function(e){var t=e.navLocation?e.navLocation:function(e){if(!e)return"none";switch(e){case"/":return"home";case"/graphsnp":return"graphsnp";case"/documentation":return"documentation";case"/snpdistance":return"matrix";default:return"none"}}(In.location.pathname);return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(En.a,{id:"header-menu",mode:"horizontal",selectedKeys:[t],overflowedIndicator:Object(n.jsx)(Dn.a,{}),children:[Object(n.jsx)(En.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ha.b,{to:"/",exact:!0,children:"Home"})},"home"),Object(n.jsx)(En.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ha.b,{to:"/snpdistance",children:"SNP distance"})},"snpdistance"),Object(n.jsx)(En.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ha.b,{to:"/graphsnp",children:"GraphSNP"})},"graphsnp"),Object(n.jsx)(En.a.Item,{style:{padding:"0 20px",margin:"0px"},onClick:function(t){e.changeNavLocation(t.key)},children:Object(n.jsx)(Ha.b,{to:"/documentation",children:"Documentation"})},"documentation")]})})})),Ln=a.p+"static/media/logo.1375c904.png",Mn=(a(1350),function(e){return Object(n.jsx)(s.a.Fragment,{children:Object(n.jsxs)(h.a,{id:"main-header",children:[Object(n.jsx)(g.a,{id:"header-navigation",xs:8,sm:18,children:Object(n.jsx)(Nn,{})}),Object(n.jsx)(g.a,{id:"header-logo",xs:16,sm:6,children:Object(n.jsx)("img",{style:{float:"right"},src:Ln,alt:"GraphSNP",height:"75px"})})]})})}),An=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=Object(n.jsxs)(p.d,{children:[Object(n.jsx)(p.b,{exact:!0,path:"/",component:Dt}),Object(n.jsx)(p.b,{path:"/graphsnp",component:qa}),Object(n.jsx)(p.b,{path:"/documentation",component:Ka}),Object(n.jsx)(p.b,{path:"/snpdistance",component:wn}),Object(n.jsx)(p.a,{to:"/"})]});return Object(n.jsxs)(p.c,{history:In,children:[Object(n.jsx)(Mn,{}),Object(n.jsx)("main",{children:e})]})}}]),a}(r.Component),kn=function(e,t){switch(t.type){case _:return t.payload;default:return e||$n.sequence}},Un=function(e,t){switch(t.type){case S:var a=Object.assign({},e);return t.payload&&t.payload!==e.navLocation&&(a.navLocation=t.payload),a;default:return e||$n.navSettings}},Fn=function(e,t){switch(t.type){case N:var a=Object.assign({},e);return t.payload&&t.payload!==e.method&&(a.method=t.payload),a;case L:var n=Object.assign({},e);return t.payload&&t.payload!==e.layout&&(n.layout=t.payload),n;case M:var r=Object.assign({},e);return t.payload!==e.isUserReDraw&&(r.isUserReDraw=t.payload),r;case A:var s=Object.assign({},e);return t.payload&&t.payload!==e.edgeFilterCutoff&&(s.edgeFilterCutoff=t.payload),s;case k:var i=Object.assign({},e);return t.payload!==e.isUserFilteringEdge&&(i.isUserFilteringEdge=t.payload),i;case U:var c=Object.assign({},e);return t.payload&&t.payload!==e.clusterMethod&&(c.clusterMethod=t.payload),c;case F:var o=Object.assign({},e);return t.payload!==e.isUserClustering&&(o.isUserClustering=t.payload),o;case P:var l=Object.assign({},e);return t.payload!==e.isEdgeScaled&&(l.isEdgeScaled=t.payload),l;case R:var d=Object.assign({},e);return t.payload!==e.edgeScaleFactor&&(d.edgeScaleFactor=t.payload),d;case q:var u=Object.assign({},e);return t.payload!==e.isHideEdgesByCutoff&&(u.isHideEdgesByCutoff=t.payload),u;case G:var p=Object.assign({},e);return t.payload!==e.hiddenEdgesCutoff&&(p.hiddenEdgesCutoff=t.payload),p;case H:var h=Object.assign({},e);return t.payload&&t.payload!==e.colorNodedBy&&(h.colorNodedBy=t.payload),h;case z:var g=Object.assign({},e);return t.payload&&t.payload!==e.exportFormat&&(g.exportFormat=t.payload),g;case B:var b=Object.assign({},e);return t.payload!==e.isUserDownloading&&(b.isUserDownloading=t.payload),b;case V:var j=Object.assign({},e);return t.payload&&t.payload!==e.transIncludeLocLevel&&(j.transIncludeLocLevel=t.payload),j;case W:var f=Object.assign({},e);return t.payload&&t.payload!==e.typeOfAnalysis&&(f.typeOfAnalysis=t.payload),f;case Y:var m=Object.assign({},e);return t.payload!==e.chartSession&&(m.chartSession=t.payload),m;case X:var x=Object.assign({},e);return t.payload!==e.isUserReloadSession&&(x.isUserReloadSession=t.payload),x;default:return e||$n.graphSettings}},Pn=function(e,t){switch(t.type){case T:return t.payload;default:return e||$n.metadata}},Rn=function(e,t){switch(t.type){case E:return t.payload;default:return e||$n.patientMovement}},qn=function(e,t){switch(t.type){case x:return t.payload;default:return e||$n.isInputLoading}},Gn=function(e,t){switch(t.type){case O:return t.payload;default:return e||$n.graphObject}},Hn=function(e,t){switch(t.type){case y:return t.payload;default:return e||$n.graphClusters}},zn=function(e,t){switch(t.type){case v:return t.payload;default:return e||$n.hammMatrix}},Bn=function(e,t){switch(t.type){case w:return t.payload;default:return e||$n.categoricalMap}},Vn=function(e,t){switch(t.type){case D:return t.payload;default:return e||$n.colorLUT}},Wn=function(e,t){switch(t.type){case $:var a=Object.assign({},e);return t.payload&&t.payload!==e.dataToDisplay&&(a.dataToDisplay=t.payload),a;case J:var n=Object.assign({},e);return t.payload&&t.payload!==e.dataColumn&&(n.dataColumn=t.payload),n;case Q:var r=Object.assign({},e);return t.payload&&t.payload!==e.dataColumnLevel&&(r.dataColumnLevel=t.payload),r;case K:var s=Object.assign({},e);return t.payload!==e.chartOrientation&&(s.chartOrientation=t.payload),s;case Z:var i=Object.assign({},e);return t.payload!==e.chartType&&(i.chartType=t.payload),i;case te:var c=Object.assign({},e);return t.payload&&t.payload!==e.snpDistExportFormat&&(c.snpDistExportFormat=t.payload),c;case ae:var o=Object.assign({},e);return t.payload!==e.isUserDrawChart&&(o.isUserDrawChart=t.payload),o;case ee:var l=Object.assign({},e);return t.payload!==e.isUserGenerateMatrix&&(l.isUserGenerateMatrix=t.payload),l;case ne:var d=Object.assign({},e);return t.payload!==e.isUserExportSnpDist&&(d.isUserExportSnpDist=t.payload),d;case re:var u=Object.assign({},e);return t.payload!==e.chartSession&&(u.chartSession=t.payload),u;case se:var p=Object.assign({},e);return t.payload!==e.isUserReloadSession&&(p.isUserReloadSession=t.payload),p;default:return e||$n.snpDistSettings}},Yn=function(e,t){switch(t.type){case C:return t.payload;default:return e||$n.selectDemoData}},Xn=function(e,t){switch(t.type){case I:return t.payload;default:return e||$n.selectedNode}},$n={sequence:null,metadata:null,patientMovement:null,selectDemoData:null,categoricalMap:null,isInputLoading:!1,hammMatrix:null,graphObject:null,graphClusters:null,selectedNode:null,graphSettings:{typeOfAnalysis:"clustering",method:"mcg",layout:"cose",isUserReDraw:!1,isUserFilteringEdge:!0,edgeFilterCutoff:25,clusterMethod:"Connected Components",isUserClustering:!1,isEdgeScaled:!1,edgeScaleFactor:1,isHideEdgesByCutoff:!1,hiddenEdgesCutoff:{min:0,max:25},colorNodedBy:"na",exportFormat:"clusterID",isUserDownloading:!1,transIncludeLocLevel:1,chartSession:null,isUserReloadSession:!1},snpDistSettings:{dataToDisplay:"all",dataColumn:null,dataColumnLevel:null,chartType:"barplot",isUserGenerateMatrix:!1,chartOrientation:"horizontal",isUserDrawChart:!1,snpDistExportFormat:"symSnpDist",isUserExportSnpDist:!1,chartSession:null,isUserReloadSession:!1},navSettings:{navLocation:null},colorLUT:null},Jn=Object(m.c)({sequence:kn,metadata:Pn,selectDemoData:Yn,categoricalMap:Bn,patientMovement:Rn,navSettings:Un,graphSettings:Fn,hammMatrix:zn,graphObject:Gn,graphClusters:Hn,isInputLoading:qn,colorLUT:Vn,snpDistSettings:Wn,selectedNode:Xn},$n),Qn=a(565),Kn=a.n(Qn),Zn=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,1398)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),r(e),s(e),i(e)}))},er=function(){return Object(m.a)(Kn.a)(m.d)(Jn,$n,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())}();c.a.render(Object(n.jsx)(f.a,{store:er,children:Object(n.jsx)(An,{})}),document.getElementById("root")),Zn()},249:function(e,t,a){},271:function(e,t,a){},530:function(e,t,a){},584:function(e,t,a){},585:function(e,t,a){},676:function(e,t){},678:function(e,t){}},[[1353,1,2]]]);